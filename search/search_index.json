{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Bases de donn\u00e9es 1 (420-2B4-VI) - Hiver 2024","text":""},{"location":"#introduction","title":"Introduction","text":"<p>Vous trouverez ici les notes et exercices du cours. J'ajouterai du nouveau contenu continuellement.</p> <p>Pr\u00e9alable \u00e0 ce cours : 420-1D6-VI Programmation 1</p> <p>Ce cours est pr\u00e9alable \u00e0 : 420-3B4-VI : Bases de donn\u00e9es 2 (approfondissement de la conception et int\u00e9gration \u00e0 des applications logicielles/web) 420-3A5-VI : D\u00e9veloppement web 2 (int\u00e9gration des BD dans un contexte web) 420-3C4-VI : Piratage \u00e9thique (s\u00e9curiser les applications) 420-4C4-VI : M\u00e9gadonn\u00e9es (efficacit\u00e9 des traitements sur de grands ensembles et base de donn\u00e9es NoSQL)  </p> <p>Il est donc pr\u00e9alable, indirectement, \u00e0 presque tous les cours de la 3e ann\u00e9e.</p> <p>Cheminement complet: https://informatique.apical.xyz/</p>"},{"location":"#environnement-de-travail","title":"Environnement de travail","text":"<p>Afin d\u2019utiliser MySQL vous devez installer deux logiciels :</p> <ul> <li>AMPPS, qui contient MySQL Server (install\u00e9 aussi dans le cours de web 1)</li> <li>MySQL Workbench</li> </ul>"},{"location":"#ampps","title":"AMPPS","text":"<p>AMPPS est une pile Apache (Apache, MySQL, Php, Perl et d\u2019autres) disponible \u00e0 https://ampps.com/</p> <p>Note : si vous avez une erreur en lien avec \u00ab Microsoft c++ redistributable \u00bb, lisez les d\u00e9tails de l\u2019erreur. S\u2019il est indiqu\u00e9 qu\u2019une autre version est d\u00e9j\u00e0 install\u00e9e, c\u2019est probablement une version plus r\u00e9cente, ce qui est sans cons\u00e9quence.</p> <p>Une fois install\u00e9, vous n\u2019avez qu\u2019\u00e0 le lancer pour voir appara\u00eetre cette petite fen\u00eatre au bas \u00e0 droite de votre \u00e9cran. Le statut de MySQL devrait \u00eatre vert (\u00e7a peut prendre quelques secondes apr\u00e8s le d\u00e9marrage pour passer du rouge au vert, c\u2019est normal).</p> <p></p> <p>Note: si vous voulez, vous pouvez configurer AMPPS pour qu'il d\u00e9marre automatiquement \u00e0 l'ouverture de votre session Windows. Sinon vous devrez le d\u00e9marrer manuellement. \u2003</p>"},{"location":"#mysql-workbench","title":"MySQL Workbench","text":"<p>T\u00e9l\u00e9chargez-le sur le site https://www.mysql.com/fr/products/workbench/</p> <p>\u00c0 l\u2019installation, choisissez \u00ab Client only \u00bb.</p> <p>Pour le lancer, il suffit de cliquer sur l\u2019application. Vous devez d\u2019abord d\u00e9marrer MySQL Server. </p> <p>Une fois l\u2019application lanc\u00e9e, vous devez ajouter une connexion en cliquant sur \u00ab + \u00bb (seulement au premier d\u00e9marrage). </p> <p></p> <p>Dans la fen\u00eatre qui appara\u00eet, entrez les infos suivantes :</p> <ul> <li> <p>Connection Name : le nom de votre connexion. Vous pouvez mettre ce que vous voulez, tant que vous le retrouvez.</p> </li> <li> <p>Password : cliquez sur Store in Vault\u2026 et entrez le mot de passe : \u00ab\u2009mysql\u2009\u00bb.</p> </li> <li> <p>[optionnel] : cliquer sur le bouton Test Connection en bas \u00e0 droite.</p> </li> <li> <p>Cliquer sur le bouton OK.</p> </li> </ul> <p></p> <p>Si tout se passe bien, vous verrez la fen\u00eatre suivante:</p> <p></p> <p>Vous allez pouvoir entrer des commandes SQL dans la zone indiqu\u00e9e. L\u2019ic\u00f4ne de disquette permet de sauvegarder vos scripts. L\u2019\u00e9clair ex\u00e9cute tout le script tandis que l\u2019\u00e9clair avec un curseur ex\u00e9cute que la requ\u00eate dans laquelle votre curseur est situ\u00e9.</p>"},{"location":"calendrier/","title":"Calendrier","text":""},{"location":"calendrier/#calendrier-des-cours","title":"Calendrier des cours","text":"SEM Cours Date Sections Mati\u00e8re Bloc Travail \u00e0 faire Remises 1 1 17 janv 1.1, 1.2 Introduction, Diagramme entit\u00e9-relation Cr\u00e9er un BD 2 19 janv 1.2 \u00e0 1.4 Types de donn\u00e9es et cr\u00e9ation de table Atelier 1 2 3 24 janv 1.5 Cl\u00e9s \u00e9trang\u00e8res et relations Atelier 2 Atelier 1 4 26-janv 1.5 Create/Update/Delete Atelier 2 3 5 31 janv 2.1, 2.2 S\u00e9lection simple, filtrage et logique Requ\u00eate CRUD Atelier 3 6 02 f\u00e9vr 2.3 Op\u00e9rations arithm, cha\u00eenes, REGEX Atelier 4 - formatif formel Atelier 3 4 7 07 f\u00e9vr 2.4 Dates Atelier 5 Atelier 4 8 09-f\u00e9vr 2.5 Jointures et aggr\u00e9gats Atelier 5 5 9 14 f\u00e9vr 2.5 Jointures et aggr\u00e9gats Atelier 6 10 16 f\u00e9vr 2.6 Fonctions statistiques Atelier 7 Atelier 6 6 11 21 f\u00e9vr R\u00e9vision formatif TP \u00e0 remettre cours 21 Atelier 7 12 23 f\u00e9vr Sommatif requ\u00eates 7 13 28 f\u00e9vr Regex avanc\u00e9 Atelier 8 14 01 mars 3.1 \u00e0 3.3 Sauvegardes et automatisation Sauvegarder/restaurer une BD Atelier 8 8 15 13 mars 4.1 Contraintes int\u00e9grit\u00e9s Confidentialit\u00e9 et coh\u00e9rence Atelier 9 16 15 mars 4.2 Cryptage et s\u00e9curit\u00e9 Atelier 9 9 17 22-mars 4.3 Gestion des acc\u00e8s 18 27 mars Temps travail 10 19 03 avr 5.1 Variables, conditionnelles et boucles Traitements automatis\u00e9s 20 05 avr 5.2 D\u00e9clencheurs 11 21 10 avr 5.2 Atelier d\u00e9clencheurs Atelier 10 TP 22 12 avr Atelier d\u00e9clencheurs 12 23 17 avr 5.3 Procedure, transactions et gestion d'erreurs Atelier 10 24 22 avr 5.3 Ateliers proc\u00e9dures Atelier 11 13 25 24 avr Ateliers proc\u00e9dures 26 26 avr 5.2 Fonctions Atelier 11 14 27 01 mai 5.2 Ateliers fonctions Atelier 12 28 03 mai R\u00e9vision Atelier 12 15 29 08 mai BD Games 30 10 mai Pratique d'examen 16 31 \u00e0 venir Retour sur la pratique d'examen 32 \u00e0 venir Examen final"},{"location":"convention/","title":"Convention de nommage MySQL","text":"<p>Bien que MySQL n'a pas vraiment de convention de nommage officiel, voici certaines des r\u00e8gles les plus utilis\u00e9es.</p> <p>Ces r\u00e8gles sont obligatoires dans notre cours.</p>"},{"location":"convention/#regles-generales","title":"R\u00e8gles g\u00e9n\u00e9rales","text":"<ul> <li>Toujours \u00e9crire les noms des tables et des colonnes (champs) en minuscule. \u00c7a peut aider \u00e0 \u00e9viter les erreurs, car MySQL est sensible \u00e0 la case</li> <li>Ne jamais utiliser d'espace, la remplacer par une barre de soulignement \"_\"</li> <li>Ne jamais utiliser de caract\u00e8res accentu\u00e9s</li> <li>Utilisez seulement des lettres dans les noms, pas de nombres ni de caract\u00e8res sp\u00e9ciaux</li> <li>\u00c9vitez d'utiliser un pr\u00e9fix dans le nom, \u00e7a complique inutilement le nom et nuit \u00e0 la visibilit\u00e9 (ex.: etudiants_prenom).</li> </ul>"},{"location":"convention/#nom-des-tables","title":"Nom des tables","text":"<ul> <li>Le nom doit \u00eatre au pluriel</li> <li>Le nom doit \u00eatre en minuscules (pas de CamelCase)</li> <li>Ne pas utiliser de pr\u00e9fix sauf si c'est in\u00e9vitable.</li> <li>Le nom doit \u00eatre clair et explicite</li> <li>Ne pas utiliser d'abr\u00e9viation</li> </ul>"},{"location":"convention/#nom-des-champs","title":"Nom des champs","text":"<ul> <li>Le nom doit \u00eatre en minuscules, sans espace et sans nombres</li> <li>On doit \u00e9viter les pr\u00e9fixes</li> <li>Utilisez un nom court, sans utiliser abr\u00e9viation par contre</li> <li>Ne pas utiliser de mot r\u00e9serv\u00e9 comme nom de champs, comme date par exemple</li> <li>Le nom d'une cl\u00e9 \u00e9trang\u00e8re devrait contenir le nom de la table et de sa cl\u00e9 primaire. Une cl\u00e9 \u00e9trang\u00e8re vers la table usager dont la cl\u00e9 primaire est le champ id devrait \u00eatre nomm\u00e9e usager_id</li> </ul>"},{"location":"ressources/","title":"Ressources","text":""},{"location":"ressources/#expressions-regulieres-regex","title":"Expressions r\u00e9guli\u00e8res (regex)","text":"<p>Pour vous former : https://regexone.com/</p> <p>Valider une regex : https://regex101.com/</p> <p>Table ASCII : https://www.asciitable.com/</p>"},{"location":"notes_de_cours/section_1.1/","title":"Introduction aux bases de donn\u00e9es relationnelles","text":""},{"location":"notes_de_cours/section_1.1/#pourquoi-utiliser-des-bases-de-donnees","title":"Pourquoi utiliser des bases de donn\u00e9es?","text":"<ul> <li>Organiser de larges quantit\u00e9s de donn\u00e9es</li> <li>S\u00e9lectionner rapidement des informations dans de grands ensembles de donn\u00e9es </li> <li>Stocker de fa\u00e7on persistante des informations</li> </ul> <p>Abr\u00e9viation : BD = Base de donn\u00e9es / DB = Database</p>"},{"location":"notes_de_cours/section_1.1/#architecture-des-bases-de-donnees","title":"Architecture des bases de donn\u00e9es","text":"<p>Mod\u00e8le client-serveur</p> <p>La base de donn\u00e9es est h\u00e9berg\u00e9e sur un serveur auquel l'utilisateur (appel\u00e9 client) se connecte pour effectuer des manipulations. Ce client peut \u00eatre un logiciel client natif ou une application web.</p> <p></p>"},{"location":"notes_de_cours/section_1.1/#systemes-de-gestion-de-base-de-donnees","title":"Syst\u00e8mes de gestion de base de donn\u00e9es","text":"<p>Les syst\u00e8mes de gestion de base de donn\u00e9es (SGBD) sont des logiciels sp\u00e9cialis\u00e9s en gestion de donn\u00e9es.</p> <ul> <li>MySQL (libre \u2014 SQL \u2014 relationnelle)</li> <li>Microsoft SQL Server (propri\u00e9taire - SQL - relationelle)</li> <li>MongoDB (libre \u2014 No SQL)</li> <li>SQLite (libre \u2014 SQL \u2014 relationnelle/embarqu\u00e9e)</li> <li>PostgreSQL (libre \u2014 SQL \u2014 relationnelle)</li> <li>Oracle (propri\u00e9taire \u2014 SQL \u2014 relationnelle)</li> </ul>"},{"location":"notes_de_cours/section_1.1/#pourquoi-utiliser-un-sgbd-plutot-quun-systeme-de-fichier-local","title":"Pourquoi utiliser un SGBD plut\u00f4t qu'un syst\u00e8me de fichier local?","text":"<p>Les SGBD offrent :</p> <ul> <li>Une gestion limitant les redondances de donn\u00e9es</li> <li>Une meilleure organisation de l'information</li> <li>R\u00e8gles d'int\u00e9grit\u00e9 (validation des donn\u00e9es)</li> <li>Contr\u00f4le de la concurrence (explications: https://www.geeksforgeeks.org/concurrency-control-in-dbms/)</li> <li>Fiabilit\u00e9/R\u00e9cup\u00e9ration des donn\u00e9es/Journalisation</li> <li>Ind\u00e9pendance du stockage des donn\u00e9es par rapport \u00e0 l'application</li> </ul>"},{"location":"notes_de_cours/section_1.1/#processus-de-developpement-dune-bd","title":"Processus de d\u00e9veloppement d'une BD","text":"<p>Dans le cours BD1, nous nous int\u00e9resserons principalement \u00e0 l'\u00e9tape de construction.</p>"},{"location":"notes_de_cours/section_1.1/#interagir-avec-une-bd","title":"Interagir avec une BD","text":"<p>Afin d'interagir avec une BD on a besoin minimalement de deux langages :</p> <ul> <li>Un langage de d\u00e9finition des donn\u00e9es (LDD) permettant entre autres de cr\u00e9er et modifier les tables et leur structure.</li> <li>Un langage de manipulation des donn\u00e9es (LMD) permettant entre autres d'ajouter, modifier ou supprimer des lignes dans des tables.</li> </ul> <p>En surplus on peut utiliser un langage de contr\u00f4le de transaction, un de contr\u00f4le des donn\u00e9es, un de gestion des acc\u00e8s et plusieurs autres...</p> <p>Heureusement, le langage de programmation Structured Query Language (Langage de requ\u00eates structur\u00e9es) abr\u00e9g\u00e9 par SQL regroupe tous ces besoins.</p> <p>Le langage SQL (prononc\u00e9 parfois \"SEE-QWEL\" par les anglophones) permet de cr\u00e9er et manipuler des BD ainsi que de g\u00e9rer certains aspects relatifs aux transactions et aux autorisations.</p>"},{"location":"notes_de_cours/section_1.1/#origine-du-langage","title":"Origine du langage","text":"<p>La toute premi\u00e8re version du langage SQL a \u00e9t\u00e9 d\u00e9velopp\u00e9e chez IBM en 1970. En 1979, la compagnie Oracle pr\u00e9senta une version commercialement disponible au grand public. SQL fut rapidement imit\u00e9 et adopt\u00e9 par d'autres fournisseurs.</p> <p>La plupart des langages de programmation imp\u00e9ratifs que vous avez vu (C#, PHP, javascript ...) sont bas\u00e9s sur la th\u00e9orie de l'algorithmie. Mais SQL provient de la th\u00e9orie des ensembles. C'est un langage D\u00c9CLARATIF qui permet de d\u00e9crire le r\u00e9sultat escompt\u00e9, sans d\u00e9crire la mani\u00e8re de l'obtenir. Les SGBD (syst\u00e8mes de gestion de bases de donn\u00e9es) tel que SQL sont \u00e9quip\u00e9s d'optimiseurs de requ\u00eates - des m\u00e9canismes qui d\u00e9terminent automatiquement la mani\u00e8re optimale d'effectuer les op\u00e9rations, notamment par une estimation de la complexit\u00e9 algorithmique. (Source: https://fr.wikipedia.org/wiki/Structured_Query_Language)</p>"},{"location":"notes_de_cours/section_1.2/","title":"Composantes d'une BD","text":"<p>Sur un serveur on peut retrouver plusieurs BD. Chaque BD est propre \u00e0 un syst\u00e8me. Les BD sont divis\u00e9es en tables. Les tables contiennent des informations sur une entit\u00e9. Les tables comportent des colonnes (aussi appel\u00e9s attributs). Chaque colonne d\u00e9crit un type de donn\u00e9es (semblable aux attributs dans une classe).</p> <p>Exemple de base de donn\u00e9es : C\u00e9gep Victo</p> <p>Table \u00abetudiants\u00bb : nom, code, ann\u00e9e d'admission, adresse, etc.</p> <p>Table \u00abenseignants\u00bb : nom, code employ\u00e9, adresse, etc.</p> <p>Table \u00abcours\u00bb : sigle, nom, etc.</p> <p>Table \u00abprogrammes\u00bb : nom, code, etc.</p>"},{"location":"notes_de_cours/section_1.2/#contenu-dune-table","title":"Contenu d'une table","text":"<p>Les tables contiennent des enregistrements qui correspondent \u00e0 une entr\u00e9e avec des valeurs indiqu\u00e9es pour chaque colonne.</p> <p>Table \u00ab etudiant \u00bb</p> Code Nom Annee admission 2345678 Steve Rogers 2019 3456789 Nathasha Romanov 2020 <p>Les enregistrements peuvent aussi \u00eatre appel\u00e9s lignes ou tuples.</p>"},{"location":"notes_de_cours/section_1.2/#notation-entite-relation","title":"Notation Entit\u00e9-relation","text":"<p>ERD (Entity relation diagram) est un langage permettant d'exprimer graphiquement la structure d'un programme ou d'une BD.</p> <p>On repr\u00e9sente les entit\u00e9s (tables pour une BD) par un rectangle dans lequel on inscrit en haut le nom de la table.</p>"},{"location":"notes_de_cours/section_1.2/#tables-en-diagrammes-er","title":"Tables en diagrammes ER","text":"<p>On remarque que les colonnes (en minuscules) sont \u00e9crites dans la bo\u00eete sous le nom.</p> <pre><code>erDiagram  \n    p[etudiants] {\n        _ code PK\n        _ nom\n        _ annee_admission\n    }\n\n    q[cours] {\n        _ cours_id PK\n        _ nom\n        _ duree\n    }\n\n    r[programmes] {\n        _ cours_id PK\n        _ nom\n        _ duree\n    }</code></pre>"},{"location":"notes_de_cours/section_1.2/#trouver-un-enregistrement","title":"Trouver un enregistrement","text":"<p>Comment faire pour identifier un enregistrement pour qu'il soit unique?</p> <p>Marquer une colonne pour forcer chaque enregistrement \u00e0 avoir une valeur distincte.</p> <p>Il est important que chaque table ait au moins une colonne unique afin de permettre facilement d'identifier les enregistrements.</p>"},{"location":"notes_de_cours/section_1.2/#cle-primaire","title":"Cl\u00e9 primaire","text":"<p>On indique qu'une colonne est la cl\u00e9 primaire avec la notation</p> <p>code\u00a0<code>&lt;pk&gt;</code></p> <p>\u00c0 noter: on rassemble en haut les colonnes de cl\u00e9 primaire</p> <pre><code>erDiagram  \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     } \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }</code></pre>"},{"location":"notes_de_cours/section_1.2/#identifier-les-cles-candidates","title":"Identifier les cl\u00e9s candidates","text":""},{"location":"notes_de_cours/section_1.2/#comment-choisir-la-cle-primaire","title":"Comment choisir la cl\u00e9 primaire?","text":"<p>On s\u00e9lectionne parmi les cl\u00e9s candidates une colonne pour jouer le r\u00f4le de cl\u00e9 primaire.</p> <p>Si aucune colonne ne satisfait les conditions, alors on ajoute une colonne identifiant (ou simplement (nom de la table)_id) qui sert de cl\u00e9 primaire.</p> <p>La colonne id sera un nombre entier dont la valeur est auto-incr\u00e9ment\u00e9e entre chaque enregistrement.</p>"},{"location":"notes_de_cours/section_1.2/#-exercice-121-","title":"--- Exercice 1.2.1 ---","text":"<p>En cr\u00e9ant une base de donn\u00e9es pour le C\u00e9gep, vous devez identifier une cl\u00e9 primaire dans la table suivante. Justifiez votre choix.</p> <pre><code>erDiagram  \n    p[enseignants] {\n        _ code_employe\n        _ nom\n        _ prenom\n        _ num_assurance_sociale\n        _ anciennete\n    }</code></pre>"},{"location":"notes_de_cours/section_1.2/#-exercice-122-","title":"--- Exercice 1.2.2 ---","text":"<p>La compagnie de livraison intergalactique du PlanetExpress souhaite informatiser son service de livraison. Pour ce faire, elle a besoin d'une base de donn\u00e9es contenant les informations sur ses vaisseaux de livraison (mod\u00e8le, immatriculation, chargement, \u00e9quipage requis) et sur les commandes (nom du destinataire, plan\u00e8te du destinataire, type de livraison , masse de la livraison et date de livraison).</p> <p>Proposez un digramme ER pour cette BD et identifiez pour chaque table une cl\u00e9 primaire.</p>"},{"location":"notes_de_cours/section_1.3/","title":"Types de donn\u00e9es","text":"<p>Donn\u00e9es num\u00e9riques Donn\u00e9es temporelles *Donn\u00e9es alphanum\u00e9riques</p> <p>Les bases de donn\u00e9es sont fortement typ\u00e9es. Chaque colonne peut contenir un type de donn\u00e9e unique. Il est impossible de le modifier apr\u00e8s la cr\u00e9ation.</p> <p>Il faut porter une attention particuli\u00e8re aux types, car l'espace de stockage est crucial dans une BD. Apr\u00e8s tout, on y stocke des milliers voire des millions d'enregistrements.</p>"},{"location":"notes_de_cours/section_1.3/#numeriques","title":"Num\u00e9riques","text":"<p>Pour les donn\u00e9es enti\u00e8res, on trouve les types suivants</p> <p></p> <p>Tir\u00e9 de https://dev.mysql.com/doc/refman/8.0/en/integer-types.html</p> <p>Pour les valeurs d\u00e9cimales, on trouve deux cat\u00e9gories : celles \u00e0 valeur exacte (virgule fixe) et \u00e0 valeur approxim\u00e9e (virgule flottante).</p> <p>\u00c0 moins de besoins particuliers, les types \u00e0 virgule flottante sont ceux \u00e0 privil\u00e9gier. La quasi-totalit\u00e9 des langages de programmation utilise une repr\u00e9sentation \u00e0 virgule flottante pour repr\u00e9senter les nombres r\u00e9els.</p> <p>Pour les nombres \u00e0 virgule fixe, les types DECIMAL et NUMERIC peuvent \u00eatre utilis\u00e9s. Ils fonctionnent de fa\u00e7on identique.</p> <p>Pour chacun, il faut sp\u00e9cifier deux valeurs pour d\u00e9terminer leur pr\u00e9cision, soit le nombre total de chiffres et le nombre de chiffres de d\u00e9cimales.</p> <p>Par exemple NUMERIC (5, 2) permet de stocker de -999,99 \u00e0 999,99</p> <p>Pour les types en virgule flottante deux types sont disponibles: FLOAT et DOUBLE.</p> Types Octets de stockage Valeur min (&gt;0) Valeur max FLOAT 4 1.175494351 E - 38 3.402823466 E + 38 DOUBLE 8 2.2250738585072 E - 308 1.7976931348623 E + 308"},{"location":"notes_de_cours/section_1.3/#temporelles","title":"Temporelles","text":"<p>Cinq types de donn\u00e9es temporelles sont disponibles.</p> <p></p> <p>Tir\u00e9 de https://dev.mysql.com/doc/refman/8.0/en/date-and-time-types.html</p> <p>DATE permet de stocker des dates de 1000-01-01 \u00e0 9999-12-31. Le format des dates (tous les types de dates) est AAAA-MM-JJ (en anglais YYYY-MM-DD).</p> <p>TIME stocke les heures de -838:59:59 \u00e0 838:59:59. Le format de toutes les dates est hhss (en anglais hhss).</p> <p>Diff\u00e9rence entre DATETIME et TIMESTAMP</p> <p>DATETIME stocke les dates sous format textuel. Le format supporte les dates de 1000-01-01 00:00:00 \u00e0 9999-12-31 23:59:59.</p> <p>TIMESTAMP compte le nombre de secondes \u00e9coul\u00e9es depuis le 1er janvier 1970. Le format supporte les dates de 1970-01-01 00:00:01 \u00e0 2038-01-19 03:14:07.</p> <p>Le type YEAR permet de stocker des ann\u00e9es \u00e0 2 ou 4 chiffres. </p> <p>Pour les ann\u00e9es \u00e0 2 chiffres, MySQL applique la conversion suivante.</p> <p>0 \u00e0 69 \u2192 2000 \u00e0 2069 70 \u00e0 99 \u2192 1970 \u00e0 1999</p>"},{"location":"notes_de_cours/section_1.3/#alphanumeriques","title":"Alphanum\u00e9riques","text":"<p>On retrouve les types de donn\u00e9es suivantes pour contenir des caract\u00e8res alphanum\u00e9riques (string).</p> <ul> <li>CHAR</li> <li>VARCHAR</li> <li>TEXT</li> <li>BLOB</li> <li>ENUM</li> </ul> <p>Le type CHAR permet de stocker jusqu'\u00e0 255 caract\u00e8res. Le type VARCHAR permet de stocker jusqu'\u00e0 65 535 caract\u00e8res. On indique entre parenth\u00e8ses la taille \u00e0 r\u00e9server pour la colonne.</p> <p>La diff\u00e9rence entre CHAR et VARCHAR est que CHAR r\u00e9serve toujours tout l'espace disponible. VARCHAR utilise un caract\u00e8re d\u00e9limiteur lui permettant d'utiliser que l'espace requis plus un bit (pour le d\u00e9limiteur) s'il y a 255 caract\u00e8res et moins et 2 caract\u00e8res s'il y a plus de 255 caract\u00e8res.</p> <p></p> <p>Tir\u00e9 de https://dev.mysql.com/doc/refman/8.0/en/char.html</p> <p>G\u00e9n\u00e9ralement, on pr\u00e9f\u00e8re utiliser VARCHAR si la taille de l'entr\u00e9e peut varier.</p> <p>Bien qu'il soit rare que l'on entrepose de longs textes dans une BD (on pr\u00e9f\u00e8re le faire dans des fichiers). Les types TEXT et BLOB permettent de le faire.</p> <p></p> <p>Tir\u00e9 de  https://dev.mysql.com/doc/refman/8.0/en/storage-requirements.html#data-types-storage-reqs-strings</p> <p>Donc un BLOB demande en espace $L+2$ bytes o\u00f9 $L &lt; 2^{16}$.</p> <p>On r\u00e9sout pour $2^{16} - 1 =65 535 + 2=65 537$ octets (64 Ko) sont n\u00e9cessaires pour stocker 65 535 caract\u00e8res. (en fran\u00e7ais avec $+/- 6$ mots par lettre en moyenne cela repr\u00e9sente un texte d'environ 1100 mots).</p> <p>LONGBLOB permet de contenir un texte d'environ 1 million de pages! (\u00e0 500 mots par page)</p> <p>Dans le cadre du cours, il faut utiliser BLOB plut\u00f4t que TEXT.</p>"},{"location":"notes_de_cours/section_1.3/#image-ou-video","title":"Image ou vid\u00e9o","text":"<p>Pour stocker une image avec une r\u00e9solution de 1920 par 1080, il faut pr\u00e9voir environ 100 Mo. Un BLOB peut contenir 65 Ko et un LONGBLOB 4.095 Go, donc il est possible d'entreposer une image en BD.</p> <p>Une vid\u00e9o HD demande 1.5 Go par heure, il serait techniquement possible de la stocker dans une BD. </p> <p>CEPENDANT, les tables \u00e9tant lues s\u00e9quentiellement, il va \u00eatre tr\u00e8s tr\u00e8s tr\u00e8s long de manipuler votre table si vous y stockez des images ou des vid\u00e9os directement.</p> <p>La strat\u00e9gie utilis\u00e9e est d'entreposer le fichier sur le disque et de laisser dans la BD le chemin d'acc\u00e8s sur le disque.</p> <p>De cette fa\u00e7on, l'acc\u00e8s en BD est rapide, et il sera possible de charger le fichier \u00e0 utilisateur qui en a de besoin.</p> <p>Le type ENUM permet de d\u00e9finir une s\u00e9rie de valeurs possibles qu'une colonne peut prendre.</p> <p>Par exemple, dans une table de donn\u00e9e de compte en banque, on veut conserver l'information sur le type de compte entre Placement, Ch\u00e8que et \u00c9pargne. </p> <p>On cr\u00e9e donc une \u00e9num\u00e9ration qui prend les 3 valeurs possibles.</p>"},{"location":"notes_de_cours/section_1.3/#-exercice-131-","title":"--- Exercice 1.3.1 ---","text":"<p>Choisissez le type de donn\u00e9es appropri\u00e9 pour les situations suivantes :</p> <ul> <li>Temp\u00e9rature ext\u00e9rieure</li> <li>Date de naissance</li> <li>Date de remise d'un travail</li> <li>Nom d'utilisateur</li> <li>Montant d'argent</li> <li>Quantit\u00e9 de retraits effectu\u00e9s d'un compte en banque</li> <li>Identifiant unique</li> <li>Description d'un produit</li> <li>Sorte d'une carte (Pique, c\u0153ur,\u2026)</li> </ul>"},{"location":"notes_de_cours/section_1.4/","title":"Cr\u00e9ation de BD et de tables","text":""},{"location":"notes_de_cours/section_1.4/#normes-de-code-du-langage-sql","title":"Normes de code du langage SQL","text":"<ul> <li>Mots-cl\u00e9s du langage en MAJUSCULE (ex.: CREATE, SELECT, etc)</li> <li>Identifiants en minuscules (notation _, pas de CamelCase)</li> <li>Nom de tables et de BD commencent par une MAJUSCULE</li> <li>Commentaires multi-lignes: / \u2026 /</li> <li>Commentaire jusqu'\u00e0 la fin de la ligne: #</li> <li>On termine une requ\u00eate par un ;</li> <li>Apostrophes simples ' ' pour d\u00e9limiter les caract\u00e8res litt\u00e9raux (string)</li> </ul> <p>Les guillemets \" \" fonctionnent seulement dans certains cas, les apostrophes simples ' ' fonctionnent dans tous les cas.</p>"},{"location":"notes_de_cours/section_1.4/#creer-une-bd","title":"Cr\u00e9er une BD","text":"<p>Pour cr\u00e9er une base de donn\u00e9es l'instruction est :</p> <pre><code>CREATE DATABASE Nom_bd;\n</code></pre> <p>Pour afficher la liste des bases de donn\u00e9es sur un serveur, on utilise la commande:</p> <pre><code>SHOW DATABASES;\n</code></pre>"},{"location":"notes_de_cours/section_1.4/#supprimer-une-bd","title":"Supprimer une BD","text":"<p>Pour supprimer une base de donn\u00e9es, l'instruction est : </p> <pre><code>DROP DATABASE Nom_bd;\n</code></pre> <p>Toutes les tables et les enregistrements sont automatiquement supprim\u00e9s. </p> <p>Attention! Aucune confirmation n'est demand\u00e9e.</p>"},{"location":"notes_de_cours/section_1.4/#-exercice-141-","title":"--- Exercice 1.4.1 ---","text":"<ol> <li>Cr\u00e9er une base de donn\u00e9es nomm\u00e9e \u00ab Exemples \u00bb</li> <li>Lister les bases de donn\u00e9es</li> <li>Supprimer la base de donn\u00e9es \u00ab Exemples \u00bb</li> <li>Lister les bases de donn\u00e9es pour confirmer</li> <li>Cr\u00e9er de nouveau une base de donn\u00e9es \u00ab Exemples \u00bb</li> </ol> <p>Quel raccourcis clavier permet d'ex\u00e9cuter toutes les lignes ou la ligne courante?</p>"},{"location":"notes_de_cours/section_1.4/#creer-une-table","title":"Cr\u00e9er une table","text":"<p>Pour cr\u00e9er une table, il faut d'abord s\u00e9lectionner une BD. La s\u00e9lection se fait \u00e0 l'aide l'instruction suivante :</p> <pre><code>USE Nom_bd;\n</code></pre> <p>La BD sera celle utilis\u00e9e pour toutes les requ\u00eates tant que l'instruction USE n'aura pas \u00e9t\u00e9 rappel\u00e9e.</p> <p>Pour cr\u00e9er une table, la syntaxe est la suivante:</p> <pre><code>CREATE TABLE Nom_table (\n    nom_colonne1 TYPE, \n    nom_colonne2 TYPE, \n    ...);\n</code></pre> <p>Exemple \u2013 Cr\u00e9er une table</p> <p>Pour cr\u00e9er la table \u00c9tudiant correspondant au mod\u00e8le suivant.</p> <pre><code>erDiagram  \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }</code></pre> <pre><code>CREATE TABLE Etudiants (\n    code INTEGER, \n    nom VARCHAR(255), \n    annee_admission YEAR);\n</code></pre>"},{"location":"notes_de_cours/section_1.4/#afficher-les-tables","title":"Afficher les tables","text":"<p>Pour afficher toutes les tables de la BD active, on utilise l'instruction :</p> <pre><code>SHOW TABLES;\n</code></pre> <p>Pour afficher la structure d'une table, on utilise l'instruction :</p> <pre><code>DESCRIBE Nom_table;\n</code></pre>"},{"location":"notes_de_cours/section_1.4/#-exercice-142-","title":"--- Exercice 1.4.2 ---","text":"<p>Cr\u00e9ez la table repr\u00e9sentant le mod\u00e8le suivant.</p> <pre><code>erDiagram  \nprogrammes {\n        INTEGER code PK\n        VARCHAR(255) nom\n        NUMERIC(8) responsable FK\n    }</code></pre> <p>Afficher la structure de la table apr\u00e8s la cr\u00e9ation pour vous valider votre op\u00e9ration.</p>"},{"location":"notes_de_cours/section_1.4/#notation-diagrammes-er","title":"Notation diagrammes ER","text":"<p>On note sur le mod\u00e8le de base de donn\u00e9es le type de donn\u00e9es associ\u00e9 au champ.</p> <p>Par exemple, pour la table \u00c9tudiant, le mod\u00e8le correspond maintenant \u00e0 </p> <pre><code>erDiagram  \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }</code></pre>"},{"location":"notes_de_cours/section_1.4/#supprimer-une-table","title":"Supprimer une table","text":"<p>Pour supprimer une table, l'instruction \u00e0 utiliser est :</p> <pre><code>DROP TABLE nom_table;\n</code></pre> <p>Tous les enregistrements sont automatiquement supprim\u00e9s.</p> <p>Attention! Aucune confirmation n'est demand\u00e9e.</p>"},{"location":"notes_de_cours/section_1.4/#cle-primaire","title":"Cl\u00e9 primaire","text":"<p>Pour indiquer qu'un champ est une cl\u00e9 primaire, on indique PRIMARY KEY apr\u00e8s le type du champ.</p> <pre><code>CREATE TABLE etudiants (\n    code INTEGER PRIMARY KEY, \n    nom VARCHAR(255), \n    adresse VARCHAR(255));\n</code></pre>"},{"location":"notes_de_cours/section_1.4/#auto-increment","title":"Auto-incr\u00e9ment","text":"<p>Dans le cas o\u00f9 l'on ajoute un identifiant unique (id), on peut indiquer au SGBD d'incr\u00e9menter automatiquement sa valeur \u00e0 chaque enregistrement. </p> <p>Cela nous \u00e9vite de devoir manuellement g\u00e9rer la mise \u00e0 jour de l'identifiant.</p> <p>Cette fonction est disponible que si le type de colonne est INTEGER.</p>"},{"location":"notes_de_cours/section_1.4/#-exercice-143-","title":"--- Exercice 1.4.3 ---","text":"<p>Pour d\u00e9finir un auto-incr\u00e9ment, il faut indiquer AUTO_INCREMENT apr\u00e8s le type de la colonne.</p> <p>Cr\u00e9er la table Cours. La colonne id_cours doit \u00eatre auto-incr\u00e9ment\u00e9e. Afficher la table apr\u00e8s pour voir l'impact de l'incr\u00e9mentation automatique.</p>"},{"location":"notes_de_cours/section_1.4/#valeurs-par-defaut","title":"Valeurs par d\u00e9faut","text":"<p>\u00c0 la cr\u00e9ation d'une table, on peut indiquer une valeur par d\u00e9faut.</p> <p>Tous les nouveaux enregistrements auront cette valeur pour la colonne sauf si une autre valeur est indiqu\u00e9e.</p> <p>On indique une valeur par d\u00e9faut en utilisant la syntaxe suivante :</p> <pre><code>nom_colonne TYPE DEFAULT valeur\n</code></pre> <p>Pour ajouter une valeur par d\u00e9faut sur un diagramme ER on l'indique avec le symbole = apr\u00e8s le type.</p> <p>Par exemple, dans la table Cours la dur\u00e9e par d\u00e9faut est de 60 heures.</p> <p><pre><code>erDiagram  \n    p[Cours] {\n        INTEGER cours_id PK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }</code></pre> La requ\u00eate pour cr\u00e9er la table cours serait donc:</p> <pre><code>CREATE TABLE Cours (  \n    cours_id INTEGER PRIMARY KEY AUTO_INCREMENT,  \n    duree TINYINT DEFAULT 60,  \n    nom VARCHAR(255);\n</code></pre>"},{"location":"notes_de_cours/section_1.4/#modifier-une-table","title":"Modifier une table","text":"<p>Pour modifier une table, trois op\u00e9rations sont possibles : ajouter une colonne, modifier une colonne, supprimer une colonne.</p> <p>La requ\u00eate est:</p> <pre><code>ALTER TABLE Nom_de_la_table \n    op\u00e9ration1, \n    op\u00e9ration2 ... ;\n</code></pre>"},{"location":"notes_de_cours/section_1.4/#ajouter-une-colonne","title":"Ajouter une colonne","text":"<p>L'instruction est ADD suivi de la d\u00e9finition de la colonne</p> <p>Par exemple, on a oubli\u00e9 une colonne dans la table Cours (on veut le r\u00e9sultat de droite)</p> <pre><code>erDiagram \n    p[Cours] {\n        INTEGER cours_id PK\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    } \n    q[Cours] {\n        INTEGER cours_id PK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }</code></pre> <p>La requ\u00eate pour corriger la table est:</p> <pre><code>ALTER TABLE Cours\n    ADD sigle CHAR(11);\n</code></pre>"},{"location":"notes_de_cours/section_1.4/#modifier-une-colonne","title":"Modifier une colonne","text":"<p>Pour modifier une colonne existante, on utilise l'instruction MODIFY COLUMN suivie de la nouvelle d\u00e9finition de la colonne.</p> <p>On a cr\u00e9\u00e9 la table Cours avec la requ\u00eate suivante:</p> <pre><code>CREATE TABLE Cours (  \n    cours_id INTEGER, \n    sigle CHAR (11),  \n    duree SMALLINT, \n    nom VARCHAR(255));\n</code></pre> <pre><code>erDiagram \n    q[Cours] {\n        INTEGER cours_id\n        CHAR(11) sigle\n        TINYINT duree\n        VARCHAR(255) nom\n    }</code></pre> <p>La requ\u00eate de modification devrait \u00eatre:</p> <pre><code>ALTER TABLE Cours   \n    MODIFY COLUMN id INTEGER PRIMARY KEY AUTO_INCREMENT,   \n    MODIFY COLUMN duree TINYINT DEFAULT 60;\n</code></pre> <pre><code>erDiagram \n    q[Cours] {\n        INTEGER cours_id PK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }</code></pre>"},{"location":"notes_de_cours/section_1.4/#supprimer-une-colonne","title":"Supprimer une colonne","text":"<p>On utilise l'instruction:</p> <pre><code>DROP COLUMN nom_colonne\n</code></pre> <p>Pour supprimer la colonne sigle de la table Cours, on utilise la requ\u00eate suivante :</p> <pre><code>ALTER TABLE Cours \n    DROP COLUMN sigle;\n</code></pre>"},{"location":"notes_de_cours/section_1.5/","title":"Cl\u00e9s \u00e9trang\u00e8res et relations","text":""},{"location":"notes_de_cours/section_1.5/#stocker-des-informations","title":"Stocker des informations","text":"<p>Imaginons maintenant que l'on souhaite stocker des informations sur quel \u00e9tudiant suit quel cours. On pourrait faire quelque chose qui ressemble \u00e0 ceci :</p> Nom Code Session Sigle cours Duree cours Nom enseignant Code employe Tony Stark 1234567 H22 420-2B4-VI 60 Kara Danvers 7654 Natasha Romanov 3456789 H22 420-2B4-VI 60 Kara Danvers 7654 Tony Stark 1234567 H22 420-2A6-VI 90 Bruce Wayne 8765 Thor Odison 6789012 H22 420-2A6-VI 90 Bruce Wayne 8765 <p>Probl\u00e8mes ?  * R\u00e9p\u00e9tition des valeurs : perte d'espace m\u00e9moire !</p>"},{"location":"notes_de_cours/section_1.5/#relations-entre-tables","title":"Relations entre tables","text":"<p>Il faut d\u00e9couper nos informations entre plusieurs tables et faire des r\u00e9f\u00e9rences entre les tables. On r\u00e9f\u00e9rence alors la cl\u00e9 primaire d'une des tables dans l'autre table. </p> <p>C'est ce que l'on appelle une cl\u00e9 \u00e9trang\u00e8re (FOREIGN KEY).</p> <p>On remarque la direction de la fl\u00e8che, de la table appel\u00e9e \u00ab enfant \u00bb vers la table  \u00ab parent \u00bb.</p> <p>On ajoute dans la table enfant un champ enseignant et une annotation de cl\u00e9 \u00e9trang\u00e8re. Donc ici chaque Cours poss\u00e8de un enseignant.</p> <pre><code>erDiagram  \n    enseignants ||--o{ cours : \"enseigne\" \nenseignants {\n        NUMERIC(8) code_employe\n        VARCHAR(255) nom\n        VARCHAR(255) prenom\n        NUMERIC(9) num_assurance_sociale\n        TINYINT anciennete\n    }\ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }    </code></pre>"},{"location":"notes_de_cours/section_1.5/#importances-des-relations","title":"Importances des relations","text":"<p>On trouve rarement une table isol\u00e9e dans un mod\u00e8le de base de donn\u00e9es (table en relation avec aucune autre table).</p> <p>Pour faire une analogie, on pourrait comporarer une table isol\u00e9e \u00e0 du code qui n'est pas r\u00e9f\u00e9renc\u00e9 (fonction qui n'est jamais appel\u00e9e) dans le domaine de la programmation.</p>"},{"location":"notes_de_cours/section_1.5/#cle-etrangere-sql","title":"Cl\u00e9 \u00e9trang\u00e8re SQL","text":"<p>Pour indiquer une cl\u00e9 \u00e9trang\u00e8re, on ajoute la contrainte suivante dans la requ\u00eate de cr\u00e9ation de la table.</p> <pre><code>FOREIGN KEY (nom_colonne) REFERENCES Table_parent(cle_primaire)\n</code></pre> <p>Exemple avec la table Cours</p> <pre><code>CREATE TABLE cours (  \n    id INTEGER PRIMARY KEY AUTO_INCREMENT,  \n    sigle CHAR (11),  \n    duree TINYINT, \n    nom VARCHAR(255),\n    enseignant NUMERIC(8),\n    FOREIGN KEY (enseignant) REFERENCES enseignants (code_employe));\n</code></pre> <p>Ici rien ne change dans la cr\u00e9ation de la table enseignants (la table ne sait pas qu'elle est utilis\u00e9e comme cl\u00e9 \u00e9trang\u00e8re ailleurs).</p>"},{"location":"notes_de_cours/section_1.5/#suppression-de-tables-qui-contiennent-des-relations","title":"Suppression de tables qui contiennent des relations","text":"<pre><code>erDiagram  \n    enseignants ||--o{ cours : \"enseigne\" \nenseignants {\n        NUMERIC(8) code_employe\n        VARCHAR(255) nom\n        VARCHAR(255) prenom\n        NUMERIC(9) num_assurance_sociale\n        TINYINT anciennete\n    }\ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    } \n</code></pre> <p>Peut-on supprimer la table Enseignant sans supprimer la table Cours? Pourquoi?</p> <p>Pour pouvoir supprimer une table, celle-ci ne doit pas \u00eatre r\u00e9f\u00e9renc\u00e9e par une autre table. Autrement dit, il faut que sa cl\u00e9 primaire ne soit pas une cl\u00e9 \u00e9trang\u00e8re pour une ou plusieurs autres tables.</p> <p>Si l'on pouvait faire la suppression, la table Cours aurait une colonne qui contiendrait des cl\u00e9s d'une table inexistante.</p>"},{"location":"notes_de_cours/section_1.5/#ordre-de-creation","title":"Ordre de cr\u00e9ation","text":"<p>Afin d'ajouter les contraintes de cl\u00e9s \u00e9trang\u00e8res, la table parent doit \u00eatre cr\u00e9\u00e9e avant la table enfants.</p> <p>Autrement, vous aurez une erreur SQL disant que votre contrainte FOREIGN KEY r\u00e9f\u00e9rence une table inexistante.</p>"},{"location":"notes_de_cours/section_1.5/#-exercice-151-","title":"--- Exercice 1.5.1 ---","text":"<p>Proposez un mod\u00e8le de base de donn\u00e9es illustrant qu'un enseignant est responsable d'un programme.</p> <p>Impl\u00e9mentez la base de donn\u00e9es correspondant \u00e0 votre mod\u00e8le.</p>"},{"location":"notes_de_cours/section_1.5/#tables-dassociation","title":"Tables d'association","text":"<p>Les cl\u00e9s \u00e9trang\u00e8res permettent de r\u00e9f\u00e9rer un enregistrement dans une autre table. Qu'arrive-t-il dans la situation suivante:</p> <p>Une BD permet de g\u00e9rer les inscriptions des \u00e9tudiants \u00e0 leurs cours. Comment repr\u00e9senter le fait qu'un \u00e9tudiant puisse s'inscrire \u00e0 plusieurs cours et qu'\u00e0 un m\u00eame cours, plusieurs \u00e9tudiants puissent s'inscrire ?</p> <p>On ajoute une table dont le r\u00f4le dont les enregistrements repr\u00e9sentent chaque relation.</p> <p>Par exemple, on ajouterait une table \u00ab Inscription \u00bb pour repr\u00e9senter notre association. Comme Inscription est cr\u00e9\u00e9e sp\u00e9cialement pour repr\u00e9senter une association, elle est appel\u00e9e table d'association.</p> <p>On voit ici que la table Inscription assure l'association entre Cours et Etudiant.</p> <p>On peut voir que deux tables sont associ\u00e9es si l'on peut suivre avec notre doigt d'une table \u00e0 l'autre en empruntant les fl\u00e8ches comme des chemins (ici le sens des fl\u00e8ches n'a pas d'importance).</p> <pre><code>erDiagram  \n    etudiants ||--o{ inscriptions : \" \" \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }\n    inscriptions }o--|| cours : \" \"\ninscriptions {\n        INTEGER cours PK\n        INTEGER etudiant PK\n        CHAR(3) session\n    }\ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }    </code></pre>"},{"location":"notes_de_cours/section_1.5/#mais-un-instant","title":"Mais... un instant!","text":"<p>Dans la table Inscription la cl\u00e9 primaire est-elle vraiment compos\u00e9e de deux colonnes?</p> <p>Oui, c'est possible: c'est appel\u00e9 une cl\u00e9 compos\u00e9e. </p> <pre><code>erDiagram   \n    etudiants ||--o{ inscriptions : \" \" \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }\n    inscriptions }o--|| cours : \" \"\ninscriptions {\n        INTEGER cours PK\n        INTEGER etudiant PK\n        CHAR(3) session\n    }\ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }   \n</code></pre>"},{"location":"notes_de_cours/section_1.5/#cle-composee","title":"Cl\u00e9 compos\u00e9e","text":"<p>Pour indiquer une cl\u00e9 compos\u00e9e dans une base de donn\u00e9es, nous devrons utiliser la notation de contrainte.</p> <p>Apr\u00e8s avoir d\u00e9clar\u00e9 les colonnes, on indique</p> <pre><code>PRIMARY KEY (nom_colonne1, nom_colonne2, \u2026 )\n</code></pre> <p>Ne fonctionne pas : <pre><code>CREATE TABLE inscription(\n    etudiant NUMERIC(7) PRIMARY KEY, \n    cours INTEGER PRIMARY KEY,\n    FOREIGN KEY (etudiant) REFERENCES etudiant (code),\n    FOREIGN KEY (cours) REFERENCES cours (cours_id));\n</code></pre></p> <p>Bonne \u00e9criture :</p> <pre><code>CREATE TABLE inscription(\n    etudiant NUMERIC(7), \n    cours INTEGER,\n    PRIMARY KEY (etudiant, cours),\n    FOREIGN KEY (etudiant) REFERENCES etudiant (code),\n    FOREIGN KEY (cours) REFERENCES cours (id_cours));\n</code></pre>"},{"location":"notes_de_cours/section_1.5/#notation-de-contraintes","title":"Notation de contraintes","text":"<p>La notation contrainte de PRIMARY KEY s'utilise aussi en pr\u00e9sence d'une cl\u00e9 simple (cl\u00e9 comportant une seule colonne).</p> <p>La notation vue pr\u00e9c\u00e9demment constitue un raccourci int\u00e9ressant lorsqu'on travaille.</p> <p>On revient plus en d\u00e9tail sur les contraintes dans le Chapitre 4 - Assurer l'int\u00e9grit\u00e9 des donn\u00e9es.</p>"},{"location":"notes_de_cours/section_2.1/","title":"Cr\u00e9er, mettre \u00e0 jour, supprimer des donn\u00e9es","text":""},{"location":"notes_de_cours/section_2.1/#requetes-sql","title":"Requ\u00eates SQL","text":"<p>L\u2019ensemble d\u2019instructions du langage SQL pour faire des requ\u00eates est diff\u00e9rent de celui pour la structure des donn\u00e9es.</p> <p>On retrouve principalement 4 types de requ\u00eates (principe CRUD):</p> <ul> <li>(Create) Insertion (INSERT)</li> <li>(Read) S\u00e9lection (SELECT)</li> <li>(Update) Mise \u00e0 jour (UPDATE)</li> <li>(Delete) Suppression (DELETE)</li> </ul>"},{"location":"notes_de_cours/section_2.1/#inserer-un-enregistrement","title":"Ins\u00e9rer un enregistrement","text":"<p>La requ\u00eate d\u2019insertion est la suivante :</p> <pre><code>INSERT INTO Nom_table (nom_colonne1, nom_colonne2,...) \nVALUES (valeur_colonne1, valeur_colonne2,...);\n</code></pre> <p>Par exemple, la requ\u00eate suivante ajoute un \u00e9tudiant dans la table \u00c9tudiant.</p> <pre><code>INSERT INTO etudiants (code, nom, \n        annee_admission, programme)\n    VALUES (1324567, 'Tony Stark', 2023,\n        '420.B0');\n</code></pre> <pre><code>erDiagram  \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }\n</code></pre> <p>Dans le cas d\u2019un champ assign\u00e9 automatiquement, comme une cl\u00e9 auto-incr\u00e9ment\u00e9e ou l\u2019utilisation d\u2019une valeur par d\u00e9faut, on n'indique pas cette colonne dans la requ\u00eate INSERT.</p> <pre><code>INSERT INTO cours (sigle, nom)\n    VALUES ('420-2B4-VI', 'Base de donn\u00e9es 1');\n</code></pre> <p>Le cours BD1 aura alors un id automatique et une dur\u00e9e de 60 heures.</p> <pre><code>erDiagram  \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }\n</code></pre> cours_id enseignant sigle duree nom 1 NULL 420-2B4-VI 60 Base de donn\u00e9es 1"},{"location":"notes_de_cours/section_2.1/#inserer-plusieurs-enregistrements","title":"Ins\u00e9rer plusieurs enregistrements","text":"<p>On peut ins\u00e9rer dans une requ\u00eate plusieurs enregistrements en les s\u00e9parant par une virgule.</p> <pre><code>INSERT INTO etudiants (code, nom, annee_admission, programme) \n    VALUES (1234567, 'Anthony Stark', 2018, '420.A0'),    \n        (2345678, 'Steve Rogers', 2018, '420.A0'),      \n        (3456789, 'Natasha Romanov', 2019, '420.A1');\n</code></pre> <pre><code>erDiagram  \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }\n</code></pre>"},{"location":"notes_de_cours/section_2.1/#omettre-le-nom-des-colonnes","title":"Omettre le nom des colonnes","text":"<p>On peut omettre le nom des colonnes \u00e0 condition que les valeurs soient ins\u00e9r\u00e9es dans l\u2019ordre des colonnes.</p> <p>Par exemple, cette instruction est valide :</p> <pre><code>INSERT INTO etudiants VALUES      \n    (1234567, '420.A0', 'Anthony Stark', 2018) \n</code></pre> <pre><code>erDiagram  \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }\n</code></pre> <p>L'instruction suivante n'est pas valide car la table cours comporte cinq colonnes et seulement deux valeurs sont indiqu\u00e9es:</p> <pre><code>INSERT INTO cours VALUES ('420-2B4-VI', 'Base de donn\u00e9es 1');\n</code></pre> <pre><code>erDiagram  \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }     </code></pre> <p>L'instruction suivante n'est pas valide car l'ordre des colonnes n\u2019est pas respect\u00e9:</p> <pre><code>INSERT INTO etudiants VALUES ('Anthony Stark', 2018, '420.A0', 1234567);\n</code></pre>"},{"location":"notes_de_cours/section_2.1/#utiliser-la-valeur-par-defaut","title":"Utiliser la valeur par d\u00e9faut","text":"<p>On peut indiquer explicitement \u00e0 SQL d\u2019utiliser la valeur par d\u00e9faut en utilisant l\u2019instruction  </p> <pre><code>DEFAULT(nom_colonne).\n</code></pre> <p>Ici le cours BD1 aura une dur\u00e9e de 60.</p> <pre><code>    INSERT INTO cours (sigle, duree, nom) VALUES      \n        ('420-2B4-VI', DEFAULT (duree), 'Base de donn\u00e9es 1'),     \n        ('420-1D6-VI', 90, 'Programmation 1');\n</code></pre>"},{"location":"notes_de_cours/section_2.1/#omettre-une-colonne","title":"Omettre une colonne","text":"<p>Si lors de l\u2019ajout d\u2019un enregistrement une colonne ne poss\u00e8de pas de valeur par d\u00e9faut et qu\u2019aucune valeur n\u2019est pr\u00e9cis\u00e9e, alors la valeur sp\u00e9ciale NULL est utilis\u00e9e.</p> <pre><code>INSERT INTO Cours (nom) VALUES ('Base de donn\u00e9es 1');\n</code></pre> <p>Ici le sigle et l'enseignant de l\u2019enregistrement sont NULL :</p> cours_id enseignant sigle duree nom 1 NULL NULL 60 Base de donn\u00e9es 1"},{"location":"notes_de_cours/section_2.1/#afficher-le-contenu-dune-table","title":"Afficher le contenu d\u2019une table","text":"<p>Pour afficher tous les enregistrements d\u2019une table, on utilise l\u2019instruction suivante :</p> <pre><code>SELECT * FROM nom_table;\n</code></pre> <p>Nous verrons dans les prochaines sections les requ\u00eates SELECT en d\u00e9tail.</p>"},{"location":"notes_de_cours/section_2.1/#-exercice-211-","title":"--- Exercice 2.1.1 ---","text":"<p>Ajoutez les enseignants et les programmes suivants:</p> <p>enseignants</p> code_employe nom num_assurance_sociale anciennete 9876 Clark Kent 150 150 150 8 8765 Bruce Wayne 260 260 260 14 7654 Kara Danvers 888 777 666 0 6573 Richard Grayson 222 444 666 4 <p>programmes </p> code nom responsable 420.A0 Informatique appliqu\u00e9e Bruce Wayne 420.B0 Informatique - jeux vid\u00e9os Kara Danvers"},{"location":"notes_de_cours/section_2.1/#mettre-a-jour-un-enregistrement","title":"Mettre \u00e0 jour un enregistrement","text":"<p>On utilise la requ\u00eate UPDATE pour mettre \u00e0 jour un enregistrement.</p> <pre><code>UPDATE nom_table SET nom_colonne1 = valeur1, nom_colonne2 = valeur2; \n</code></pre> <p>Cette syntaxe comporte un d\u00e9faut car ici, on met \u00e0 jour tous les enregistrements! Dans la plupart des cas, ce n\u2019est pas ce qu\u2019on cherche \u00e0 faire.</p> <p>Pour indiquer quel enregistrement mettre \u00e0 jour, on utilise la clause WHERE qui permet de sp\u00e9cifier une condition. </p>"},{"location":"notes_de_cours/section_2.1/#clause-where","title":"Clause WHERE","text":"<p>La syntaxe d\u2019une requ\u00eate UPDATE avec la clause WHERE est :</p> <pre><code>UPDATE nom_table \n    SET nom_colonne1 = valeur1, nom_colonne2 = valeur 2, ...\n    WHERE condition;\n</code></pre> <p>Par exemple, on souhaite que le programme 420.A0 (Informatique appliqu\u00e9e) soit maintenant sous la responsabilit\u00e9 de Clark Kent (9876).</p> <pre><code>UPDATE programmes\n    SET responsable = 9876\n    WHERE code = '420.B0'; \n</code></pre> <pre><code>erDiagram  \nprogrammes {\n        INTEGER code PK\n        VARCHAR(255) nom\n        NUMERIC(8) responsable FK\n    }</code></pre>"},{"location":"notes_de_cours/section_2.1/#desactiver-le-safemode","title":"D\u00e9sactiver le SafeMode","text":"<p>Si vous n'indiquez pas de clause WHERE ou que celle-ci ne s'applique pas sur une cl\u00e9, alors la requ\u00eate sera bloqu\u00e9e par le SafeMode.</p> <p>Pour d\u00e9sactiver le SafeMode :</p> <p>Edit &gt; Preferences &gt; SQLEditor &gt; Safe updates Puis reconnectez-vous au serveur.</p>"},{"location":"notes_de_cours/section_2.1/#-exercice-212-","title":"--- Exercice 2.1.2 ---","text":"<p>A. Mettez \u00e0 jour le profil de Kara Danvers pour assigner la valeur 1 \u00e0 son anciennet\u00e9.</p> <p>B. Mettez \u00e0 jour le cours BD1 pour qu'il ait une dur\u00e9e de 90 heures.</p>"},{"location":"notes_de_cours/section_2.1/#duplicata-de-cle-primaire","title":"Duplicata de cl\u00e9 primaire","text":"<p>Qu\u2019arrive-t-il si on ajoute un enregistrement pour lequel la cl\u00e9 primaire existe d\u00e9j\u00e0?</p> <p>2 choix :</p> <p>1) Provoquer une erreur (ce qui se produit normalement)</p> <p>2) Offrir la possibilit\u00e9 de mettre \u00e0 jour l\u2019enregistrement</p>"},{"location":"notes_de_cours/section_2.1/#mettre-a-jour-si-la-cle-existe-deja","title":"Mettre \u00e0 jour si la cl\u00e9 existe d\u00e9j\u00e0","text":"<p>On modifie la requ\u00eate INSERT de la fa\u00e7on suivante :</p> <pre><code>INSERT INTO nom_table (nom_colonne1, nom_colonne2,\u2026)\n    VALUES (valeur1, valeur2,\u2026)\n    ON DUPLICATE KEY UPDATE;\n</code></pre> <p>Note: il n'est pas toujours une bonne id\u00e9e d\u2019utiliser ON DUPLICATE KEY UPDATE.</p> <p>Souvent, on veut signaler une erreur pour indiquer \u00e0 l\u2019utilisateur qu\u2019il fait une op\u00e9ration non standard.</p> <p>On peut utiliser ON DUPLICATE KEY UPDATE lorsqu\u2019on transf\u00e8re des donn\u00e9es ou que l\u2019on est s\u00fbr que les enregistrements sont identiques.</p>"},{"location":"notes_de_cours/section_2.1/#supprimer-un-enregistrement","title":"Supprimer un enregistrement","text":"<p>La requ\u00eate de suppression est DELETE et a la syntaxe suivante :</p> <pre><code>DELETE FROM nom_table WHERE condition;\n</code></pre> <p>Comme pour les requ\u00eates DROP, aucune confirmation n'est demand\u00e9e.</p> <p>Attention : s\u2019il n\u2019y a pas de clause WHERE et que le SafeMode est d\u00e9sactiv\u00e9, vous allez supprimer toutes les donn\u00e9es de la table.</p>"},{"location":"notes_de_cours/section_2.1/#-exercice-213-","title":"--- Exercice 2.1.3 ---","text":"<p>L'enseignant Bruce Wayne souhaite quitter son poste d'enseignant pour devenir un riche homme d'affaires. Retirez-le de la table Enseignants.</p> <p>Ajoutez-le de nouveau par la suite et r\u00e9assignez-le comme responsable de programme.</p> <p>Difficult\u00e9s : </p> <ol> <li>V\u00e9rifier vos contraintes de cl\u00e9 \u00e9trang\u00e8re</li> <li>Pour v\u00e9rifier si une valeur est NULL, on doit utiliser l'expression IS NULL    et non \u00ab = NULL \u00bb (et != NULL devient IS NOT NULL)</li> </ol>"},{"location":"notes_de_cours/section_2.2/","title":"S\u00e9lection, filtrage et op\u00e9rateurs logiques","text":"<p>S\u00e9lection de colonnes Filtrage des r\u00e9sultats Op\u00e9rateurs logiques Ordonner et limiter</p>"},{"location":"notes_de_cours/section_2.2/#selection-de-colonnes","title":"S\u00e9lection de colonnes","text":"<p>Pour s\u00e9lectionner des donn\u00e9es, la requ\u00eate est SELECT et \u00e0 la syntaxe de base suivante :</p> <pre><code>SELECT nom_colonne1, nom_colonne2,\u2026 FROM nom_table;\n</code></pre> <p>On indique apr\u00e8s le SELECT que le nom des colonnes que l\u2019on souhaite r\u00e9cup\u00e9rer.</p> <p>Pour r\u00e9cup\u00e9rer les colonnes sigle et nom de la table Cours, on utilise la requ\u00eate suivante :</p> <pre><code>SELECT sigle, nom FROM cours;\n</code></pre> <p>On utilise le symbole * pour indiquer la s\u00e9lection de toutes les colonnes.</p> <pre><code>SELECT * FROM nom_table;\n</code></pre> <pre><code>erDiagram  \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }\n</code></pre>"},{"location":"notes_de_cours/section_2.2/#alias","title":"Alias","text":"<p>Il est possible de renommer des colonnes lors de la s\u00e9lection (on verra plus tard des applications de ce concept)</p> <p>Le mot-cl\u00e9 \u00e0 utiliser est AS</p> <pre><code>SELECT sigle, nom AS nom_cours FROM cours \n</code></pre>"},{"location":"notes_de_cours/section_2.2/#filtrer-les-enregistrements","title":"Filtrer les enregistrements","text":"<p>Tout comme dans un UPDATE ou DELETE, il est possible d'utiliser la clause WHERE dans un SELECT afin de restreindre le nombre d'enregistrements affect\u00e9s.</p> <pre><code>SELECT nom_colonne1, nom_colonne2,\u2026 FROM nom_table \n    WHERE condition;\n</code></pre>"},{"location":"notes_de_cours/section_2.2/#creation-de-conditions","title":"Cr\u00e9ation de conditions","text":"<p>On peut utiliser les op\u00e9rateurs suivants pour construire des conditions.</p> Op\u00e9rateur Symbole \u00c9gal = Diff\u00e9rent de &lt;&gt; Plus grand que &gt; Plus grand ou \u00e9gal que &gt;= Plus petit que &lt; Plus petit ou \u00e9gal que &lt;="},{"location":"notes_de_cours/section_2.2/#clause-where-avec-valeur-null","title":"Clause WHERE avec valeur NULL","text":"<p>Pour r\u00e9cup\u00e9rer les colonnes dont la valeur est NULL, la structure de la condition est diff\u00e9rente. Il faut utiliser le mot-cl\u00e9 IS.</p> <pre><code>SELECT nom_colonne1, nom_colonne2... FROM nom_table WHERE nom_colonne IS NULL;\n</code></pre> <p>On ajoute le mot-cl\u00e9 NOT pour avoir les colonnes qui ne sont pas NULL</p> <pre><code>SELECT nom_colonne1, nom_colonne2... FROM nom_table WHERE nom_colonne IS NOT NULL;\n</code></pre> <p>Pour s\u00e9lectionner le nom des cours dont la dur\u00e9e est sup\u00e9rieure ou \u00e9gale \u00e0 60 heures on utilise la requ\u00eate suivante.</p> <pre><code>SELECT nom FROM cours \n    WHERE duree &gt;= 60;\n</code></pre> <p>Pour s\u00e9lectionner les sigles des cours dont le nom est NULL, on utilise la requ\u00eate suivante.</p> <pre><code>SELECT sigle FROM cours \n    WHERE nom IS NULL;\n</code></pre> <pre><code>erDiagram  \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    } </code></pre> <p>On peut combiner les op\u00e9rations de filtrage en utilisant les op\u00e9rateurs logiques.</p> Op\u00e9rateur Instruction Et AND Ou OR <p>S\u00e9lectionnez le nom des cours o\u00f9 la dur\u00e9e est entre 60 et 75 heures incluse.</p> <pre><code>SELECT nom FROM Cours\n    WHERE duree &gt;= 60 AND duree &lt;= 75;\n</code></pre> <pre><code>erDiagram  \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    } </code></pre>"},{"location":"notes_de_cours/section_2.2/#-exercice-221-","title":"--- Exercice 2.2.1 ---","text":"<p>\u00c0 partir du script Ecole.sql</p> <p>A. S\u00e9lectionnez les codes d'employ\u00e9 des enseignants qui ont au moins 5 ans d'anciennet\u00e9. B. S\u00e9lectionnez le nom des \u00e9tudiants admis entre 2019 et 2020. C. S\u00e9lectionnez la date de d\u00e9but de session de toutes les sessions d'automne.  </p>"},{"location":"notes_de_cours/section_2.2/#ordonner-les-resultats","title":"Ordonner les r\u00e9sultats","text":"<p>Pour obtenir des r\u00e9sultats tri\u00e9s, on utilise la clause ORDER BY. Cette clause est optionnelle.</p> <pre><code>SELECT nom_colonne1, nom_colonne2, ... FROM Nom_table\n    WHERE condition\n    ORDER BY nom_colonne1, nom_colonne2, ...\n</code></pre> <p>Il faut porter attention \u00e0 la taille de la s\u00e9lection, car un tri devient vite couteux en ressources.</p> <p>Pour s\u00e9lectionner le nom et la dur\u00e9e des cours et les classer en ordre alphab\u00e9tique on utilise la requete suivante.</p> <pre><code>SELECT nom, duree FROM cours\n    ORDER by nom;\n</code></pre> <pre><code>erDiagram  \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    } </code></pre> <p>Maintenant, on veut la m\u00eame requ\u00eate, mais en ordonnant d'abord par dur\u00e9e, puis par ordre alphab\u00e9tique. Voici le r\u00e9sultat attendu :</p> nom duree Math\u00e9matique de l'ordinateur 45 Base de donnees 1 60 Fonctionnement de l'ordinateur 60 D\u00e9veloppement Web 2 75 Programmation 1 90 Programmation 2 90 <p>On peut trier sur plusieurs colonnes en les s\u00e9parant par des virgules. Le tri se fait en ordre inverse que les colonnes sont indiqu\u00e9es.</p> <pre><code>SELECT nom, duree FROM cours\n    ORDER BY duree, nom;\n</code></pre> <p>Ici on tri par ordre alphab\u00e9tique et apr\u00e8s par dur\u00e9e. Donc le r\u00e9sultat final est globablement tri\u00e9 par dur\u00e9e, et pour chaque dur\u00e9e, les \u00e9l\u00e9ments sont en ordre alphab\u00e9tique.</p>"},{"location":"notes_de_cours/section_2.2/#tris-stables-et-instables","title":"Tris stables et instables","text":"<ul> <li> <p>Dans la th\u00e9orie des tris (oui, \u00e7a existe et c'est assez riche comme th\u00e9orie), on parle de tri stable si, pour des valeurs \u00e9gales, l'ordre original est pr\u00e9serv\u00e9.</p> </li> <li> <p>Dans l'exemple pr\u00e9c\u00e9dent, on tri par ordre alphab\u00e9tique d'abord. Ensuite, quand on tri par dur\u00e9e, deux cours de m\u00eame dur\u00e9e resteront dans l'ordre (le tri par dur\u00e9e ne change pas l'ordre des \u00e9l\u00e9ments). C'est ce qu'on appelle un tri stable.</p> </li> <li> <p>Bien qu'int\u00e9ressant parce qu'ils permettent le tri par plusieurs colonnes successivement, les tris stables (bubble, insertion, merge) sont g\u00e9n\u00e9ralement plus lents que les tris instables (quicksort, shellsort, radix, bogosort (a.k.a stupid sort)).</p> </li> </ul>"},{"location":"notes_de_cours/section_2.2/#ordonnancement-des-caracteres","title":"Ordonnancement des caract\u00e8res","text":"<p>Comment se fait un tri sur un CHAR/VARCHAR ?</p> <ul> <li> <p>Par le code ASCII donc num\u00e9ro en premier, ensuite lettres majuscules, ensuite lettres minuscules.</p> </li> <li> <p>\u00abBoujour\u00bb vient donc avant \u00aballo\u00bb</p> </li> <li> <p>Certains caract\u00e8res sp\u00e9ciaux sont entre les majuscules et minuscules!</p> </li> </ul>"},{"location":"notes_de_cours/section_2.2/#ordre-decroissant","title":"Ordre d\u00e9croissant","text":"<p>On peut ajouter l\u2019ordre du tri apr\u00e8s le nom d'une colonne dans la clause ORDER BY.</p> <ul> <li>ASC pour ascendant (croissant). Cette valeur est celle par d\u00e9faut.</li> <li>DESC pour descendant (d\u00e9croissant)</li> </ul> <pre><code>SELECT * FROM Table\n    ORDER BY nom_colonne1, nom_colonne2 DESC;\n\nSELECT * FROM Table\n    ORDER BY nom_colonne1 DESC, nom_colonne2;\n</code></pre>"},{"location":"notes_de_cours/section_2.2/#limiter-les-resultats","title":"Limiter les r\u00e9sultats","text":"<p>On peut aussi indiquer un nombre maximal de r\u00e9sultats \u00e0 afficher avec la clause LIMIT</p> <pre><code>LIMIT nombre_s\u00e9lectionn\u00e9\nLIMIT premier_enregistrement, nombre_s\u00e9lectionn\u00e9\n</code></pre> <p>La clause LIMIT est optionnelle.</p> <p>On veut par exemple seulement les 5 premiers cours pour avoir un aper\u00e7u des donn\u00e9es dans la table Cours.</p> <pre><code>SELECT * FROM Cours\n    LIMIT 0, 5;\n\n## Alternative\n\nSELECT * FROM Cours\n    LIMIT 5;\n</code></pre>"},{"location":"notes_de_cours/section_2.2/#-exercice-222-","title":"--- Exercice 2.2.2 ---","text":"<p>A. S\u00e9lectionnez les 5 \u00e9valuations ayant la plus basse pond\u00e9ration</p> <p>B. S\u00e9lectionnez le nom des 3 \u00e9tudiants qui ont \u00e9t\u00e9 admis le plus r\u00e9cemment</p> <p>C. S\u00e9lectionnez tous les groupes, tri\u00e9s par num\u00e9ro de groupe en ordre croissant et par session, de la plus r\u00e9cente \u00e0 la plus ancienne (supposez que les sessions sont ajout\u00e9es dans l'ordre quelles arrivent). Les groupes d'un m\u00eame cours doivent \u00eatre regroup\u00e9s \u00e0 l'affichage.</p>"},{"location":"notes_de_cours/section_2.3/","title":"Op\u00e9rateurs arithm\u00e9tiques et cha\u00eenes de caract\u00e8res","text":""},{"location":"notes_de_cours/section_2.3/#operations-arithmetiques","title":"Op\u00e9rations arithm\u00e9tiques","text":"<p>On peut effectuer des op\u00e9rations arithm\u00e9tiques lors des requ\u00eates.</p> Op\u00e9rateur Symbole Addition + Soustraction - Multiplication * Division / Modulo % <p>On veut s\u00e9lectionner le nombre d\u2019heures par semaine de chaque cours, sachant qu'une session dure 15 semaines.</p> <pre><code>SELECT duree / 15 FROM Cours;\n</code></pre> <p>On peut utiliser des noms de colonne des deux c\u00f4t\u00e9s de l'op\u00e9rateur.</p> <pre><code>erDiagram  \ncours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    } </code></pre>"},{"location":"notes_de_cours/section_2.3/#recherche-sur-les-chaines-de-caracteres","title":"Recherche sur les cha\u00eenes de caract\u00e8res","text":"<p>Pour rechercher simplement sur des cha\u00eenes de caract\u00e8res (CHAR, VARCHAR) on utilise l\u2019op\u00e9rateur LIKE et les patterns de recherche.</p> <p>Les patterns disposes de 3 caract\u00e8res sp\u00e9ciaux :</p> <ul> <li>% : correspond \u00e0 0, 1 ou plusieurs caract\u00e8res</li> <li>_ : correspond \u00e0 1 unique caract\u00e8re</li> <li>\\ : permet d\u2019\u00e9chapper les caract\u00e8res % ou _</li> </ul> <p>Rechercher sur un objet TEXT risque de prendre \u00e9norm\u00e9ment de temps. C'est le type d'op\u00e9ration qu'on \u00e9vite \u00e0 moins d'y \u00eatre contraint.</p> <p>Rechercher tous les mots qui commencent par des:</p> <ul> <li>Pattern : des%</li> </ul> <p>Rechercher des mots de 2 lettres terminant par e:</p> <ul> <li>Pattern : _e</li> </ul> <p>Rechercher des mots terminant par le symbole %:</p> <ul> <li>Pattern : %\\%</li> </ul>"},{"location":"notes_de_cours/section_2.3/#exemple-like","title":"Exemple LIKE","text":"<p>On veut s\u00e9lectionner les pond\u00e9rations et le titre de toutes les \u00e9valuation comportant le mot \u00ab final \u00bb ou \u00ab finale \u00bb</p> <pre><code>SELECT ponderation, titre FROM Evaluation \n  WHERE titre LIKE '%final%';\n</code></pre> <p>On peut utiliser des noms de colonne des deux c\u00f4t\u00e9s de l'op\u00e9rateur.</p> <pre><code>erDiagram  \nevaluations {\n        INTEGER evaluation_id PK \n        INTEGER group FK \n        VARCHAR(64) titre\n        NUMERIC(4_1) ponderation\n        DATETIME date_passage \n    } </code></pre>"},{"location":"notes_de_cours/section_2.3/#expressions-regulieres-regex","title":"Expressions r\u00e9guli\u00e8res (Regex)","text":"<p>Les patterns sont simples \u00e0 utiliser, mais aussi limit\u00e9s. Pour faire une recherche plus avanc\u00e9e, on utilise les REGEX (Regular Expression).</p> <p>Notez que l'utilisation des Regex peut devenir rapidement complexe. Pour vous aider \u00e0 vous former, utilisez le site https://regexone.com/.</p> <p>Pour introduire une REGEX en MySQL, on utilise la syntaxe suivante :</p> <pre><code>SELECT colonne FROM Table WHERE colonne RLIKE 'regex';\n</code></pre>"},{"location":"notes_de_cours/section_2.3/#rechercher-un-caractere","title":"Rechercher un caract\u00e8re","text":"<p>\u00c0 moins qu'il s'agisse d'un caract\u00e8re sp\u00e9cial, indiquez une lettre dans une REGEX permet de chercher celle-ci, n'importe o\u00f9 dans la cha\u00eene.</p> Cha\u00eene Regex Trouv\u00e9 abc a Oui cba a Oui abc ab Oui cba ab Non cba ba Oui abc d Non"},{"location":"notes_de_cours/section_2.3/#debut-et-fin","title":"D\u00e9but et fin","text":"<p>Pour indiquer le d\u00e9but d'une cha\u00eene, on utilise le symbole ^, et pour la fin, le symbole $.</p> Cha\u00eene Regex Trouv\u00e9 abc ^a Oui cba a$ Oui abc ^bc Non abc ^ab$ Non abc ab$ Non"},{"location":"notes_de_cours/section_2.3/#repetitions","title":"R\u00e9p\u00e9titions","text":"<p>Les REGEX offrent 3 diff\u00e9rents caract\u00e8res sp\u00e9ciaux pour la r\u00e9p\u00e9tition : * * : indique que le caract\u00e8re peut s'y trouver 0, 1 ou plusieurs fois * ? : indique que le caract\u00e8re peut s'y trouver 0 ou 1 fois * + : indique que le caract\u00e8re doit s'y trouver au moins une fois (1 ou plusieurs)</p> Cha\u00eene Regex Trouv\u00e9 abc a* Oui cba a+ Oui abc b*c Oui aac b*c Oui aac a?c Non Cha\u00eene Regex Trouv\u00e9 aac a+c Oui bbc a+c Non aaaaaaaaaaaa a* Oui aaaaaaaaaaaa a? Non aaaaaaaaaaaa a+ Oui"},{"location":"notes_de_cours/section_2.3/#-exercice-231-","title":"--- Exercice 2.3.1 ---","text":"<p>\u00c9crivez les REGEX pour trouver les informations suivantes parmis les mots suivants :</p> <p>chat</p> <p>chaton</p> <p>chatte</p> <p>carotte</p> <p>chalet</p> <p>valet</p> <p>animal</p> <p>Utilisez le site https://regex101.com/ pour vous aider.</p> <p>A. Les mots contenant \u00ab chat \u00bb (3 mots) B. Les mots commen\u00e7ant par \u00ab ch \u00bb (4 mots) C. Les mots contenant un ou deux 2 \u00ab t \u00bb (6 mots) D. Les mots finissant par \u00ab et \u00bb ou \u00ab e \u00bb (4 mots) E. Les mots contenant \u00ab a \u00bb suivis de 1 ou plusieurs \u00ab t \u00bb (3 mots)</p>"},{"location":"notes_de_cours/section_2.3/#repetitions-suite","title":"R\u00e9p\u00e9titions (suite)","text":"<p>On peut aussi sp\u00e9cifier le nombre exacte de r\u00e9p\u00e9tition recherch\u00e9 ou les mettre dans un intervalle. On utilise la notation {min, max} ou {nombre}. On peut omettre le max si l'on cherche au moins x caract\u00e8res et omettre le min si l'on cherche au plus x caract\u00e8res</p> Intervalle Signification {1, 3} Entre 1 et 3 r\u00e9p\u00e9titions {4} Exactement 4 r\u00e9p\u00e9titions {5,} 5 r\u00e9p\u00e9titions et plus {,2} Pas plus de 2 r\u00e9p\u00e9titions (\u00e9quivalent \u00e0 {0, 2}) {3,1} Provoque une erreur"},{"location":"notes_de_cours/section_2.3/#classes-de-caracteres","title":"Classes de caract\u00e8res","text":"<p>On peut s\u00e9lectionner tous les caract\u00e8res compris entre deux caract\u00e8res (au sens du code ASCII), dans un ordre quelconque avec les classes de caract\u00e8res. </p> <p>On indique une classe avec [min-max]. On peut juxtapos\u00e9 des intervalles pour augmenter la port\u00e9e de la classe.</p> Classe Signification [a-z] N'importe quelle lettre minuscule [02468] N'importe quel nombre pair [a-zA-Z] N'importe quelle lettre majuscule ou minuscule [a-z-] N'importe quelle lettre minuscule et le trait d'union (toujours \u00e0 la fin !) [a-zA-Z0-9] N'importe quelle lettre ou nombre \u00c9nonc\u00e9 REGEX Un num\u00e9ro de t\u00e9l\u00e9phone [0-9]{3}-[0-9]{3}-[0-9]{4} Une s\u00e9quence contenant entre 3 et 8 lettres [a-zA-Z]{3,8} Un mot de 6 lettres commen\u00e7ant par h ^h[a-z]{5}$"},{"location":"notes_de_cours/section_2.3/#-exercice-232-","title":"--- Exercice 2.3.2 ---","text":"<p>\u00c9crivez les REGEX pour trouver les informations suivantes parmis les mots suivants : chat, chaton, chatte, carotte, chalet, valet, animal</p> <p>Utilisez le site https://regex101.com/ pour vous aider.</p> <p>A. Les mots de 4 lettres (1 mot) B. Les mots d\u00e9butant par \u00ab cha \u00bb et ayant au moins 5 lettres (3 mots) C. Les mots qui contiennent au moins 3 voyelles. (2 mots)</p>"},{"location":"notes_de_cours/section_2.3/#classes-speciales","title":"Classes sp\u00e9ciales","text":"<p>Les REGEX d\u00e9finissent un certains nombres de classes et de caract\u00e8res sp\u00e9ciaux.</p> Classe Signification w Tout caract\u00e8re de mot (lettre et nombres) [a-zA-Z0-9_] d Tout nombre [0-9] s Espaces [nrt ] W D S La n\u00e9gation de la classe associ\u00e9 \u00e0 la minuscule"},{"location":"notes_de_cours/section_2.3/#classes-speciales-mysql","title":"Classes sp\u00e9ciales MySQL","text":"<p>Les REGEX dans MySQL d\u00e9finissent des classes sp\u00e9ciales qui leur sont propres. Pour les utiliser on les \u00e9crits entre crochets en utilisant la syntaxe suivante :</p> <pre><code>[:classe de caractere:]\n</code></pre> Nom de la classe Contenu alnum Caract\u00e8res alphanum\u00e9riques (comme w sauf _) alpha Caract\u00e8res de l'alphabet space Caract\u00e8res d'espacement (semblable \u00e0 s) cntrl Caract\u00e8res de contr\u00f4les (comme tabulation ou retour \u00e0 la ligne) digit Caract\u00e8res num\u00e9riques (comme d) lower, upper Caract\u00e8res alphab\u00e9tiques minuscules ou majuscules <p>Plus de  classes : https://dev.mysql.com/doc/refman/8.0/en/regexp.html#regexp-syntax</p>"},{"location":"notes_de_cours/section_2.3/#caractere-speciaux","title":"Caract\u00e8re sp\u00e9ciaux","text":"Classe Signification . N'importe quel caract\u00e8re | Op\u00e9rateur ou ^ Op\u00e9rateur de n\u00e9gation - Trait d'union, doit toujours \u00eatre \u00e0 la fin d'une classe <p>Par exemple [^ab] v\u00e9rifie que ni \u00ab a \u00bb ni \u00ab b \u00bb appara\u00eessent.</p>"},{"location":"notes_de_cours/section_2.3/#options","title":"Options","text":"<p>\u00c0 la fin d'une REGEX on peut indiquer certaines options. Cela ne fonctionne pas en MySQL. Voici les options les plus communes.</p> Lettre Option g Greedy : retourne toutes les occurences o\u00f9 la REGEX est trouv\u00e9e (Pas en SQL) U Ungreedy : retourne uniquement la premi\u00e8re occurence o\u00f9 la REGEX est trouv\u00e9e (Pas en SQL) m Multiline : ^ et $ indique le d\u00e9but et la fin d'une ligne i Case insensitive : la recherche n'est pas sensible \u00e0 la casse c Case sensitive : la recherche est sensible \u00e0 la casse"},{"location":"notes_de_cours/section_2.4/","title":"Manipulation de dates","text":"<p>Les fonctions SQL date, time et datetime permettent de convertir explicitement une cha\u00eene de caract\u00e8re en DATE, TIME ou DATETIME respectivement (ou convertir les formats de date entre eux). \u00c0 l'insertion des donn\u00e9es, des conversions implicitent s'op\u00e8rent.</p> <pre><code>erDiagram  \netudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     } </code></pre> <pre><code>INSERT INTO etudiants (code, nom, annee_admission, \n    date_naissance, programme) VALUES\n    (1234567, 'Tony Stark', 2019, date('1970-05-29'), '420.A0'),\n    (2345678, 'Steve Rogers' 2019, date('1918-07-04'), '420.A0');\n</code></pre>"},{"location":"notes_de_cours/section_2.4/#extraire-des-informations-de-la-datetemps","title":"Extraire des informations de la date/temps","text":"<p>On peut avoir besoin d\u2019extraire certains \u00e9l\u00e9ments des types DATE, TIME ou DATETIME.</p> <p>Une fonction existe pour chaque type. La fonction extract permet d\u2019extraire plusieurs informations \u00e0 la fois.</p> <p>https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_extract</p> <p>Exemple : vendredi 2021-02-05 11:04:19</p> Fonction Retourne Valeur year l'ann\u00e9e 2021 month le num\u00e9ro du mois 2 day / dayofmonth le num\u00e9ro du jour dans le mois 5 hour l'heure 11 minute le nombre de minute 4 second le nombre de secondes 19 <p>Exemple : vendredi 2021-02-05 11:04:19</p> Fonction Retourne Valeur dayofweek le num\u00e9ro du jour de la semaine (0 = dimanche) 5 dayname le nom du jour (anglais) Friday monthname le nom du mois (anglais) February dayofyear le num\u00e9ro du jour dans l'ann\u00e9e 36 weekofyear le num\u00e9ro de la semaine dans l'ann\u00e9e 5 week le num\u00e9ro de la semaine 5"},{"location":"notes_de_cours/section_2.4/#date-et-heure-actuelle","title":"Date et heure actuelle","text":"<p>On utilise les fonctions suivantes pour obtenir la date et l\u2019heure actuelle.</p> Fonction Type de retour now DATETIME current_date DATE current_time TIME current_timestamp TIMESTAMP"},{"location":"notes_de_cours/section_2.4/#differences-de-temps","title":"Diff\u00e9rences de temps","text":"<p>Pour consid\u00e9rer la diff\u00e9rence entre 2 temps (TIME ou DATETIME), on utilise la fonction timediff.</p> <p>Le r\u00e9sultat de timediff est exprim\u00e9 en termes de TIME. Si un type DATETIME est utilis\u00e9, la partie de la date est ignor\u00e9e.</p> <p>Les deux arguments doivent \u00eatre du m\u00eame type.</p>"},{"location":"notes_de_cours/section_2.4/#exemple-de-timediff","title":"Exemple de timediff","text":"<p>Par exemple, chaque periode du cours poss\u00e8de un temps de d\u00e9but et de fin et on souhaite conna\u00eetre la longueur des p\u00e9riodes.</p> <pre><code>SELECT periode_id, heure_debut, heure_fin, \n       timediff(heure_fin, heure_debut) \n    FROM periodes; \n</code></pre> periode_id heure_debut heure_fin timediff(heure_fin, heure_debut) 1 09:15:00 11:05:00 01:50:00 2 08:15:00 12:05:00 03:50:00 3 15:15:00 16:05:00 00:50:00 <pre><code>erDiagram  \n    periodes {\n        int periode_id PK\n        time heure_debut\n        time heure_fin\n    }</code></pre>"},{"location":"notes_de_cours/section_2.4/#difference-de-dates","title":"Diff\u00e9rence de dates","text":"<p>De m\u00eame fa\u00e7on la fonction datediff permet de calculer la diff\u00e9rence entre deux dates.</p> <p>Le r\u00e9sultat de datediff est exprim\u00e9 en termes de nombre de jours. Si un type DATETIME est utilis\u00e9, la partie du temps est ignor\u00e9e.</p> <p>Les deux arguments doivent \u00eatre du m\u00eame type.</p>"},{"location":"notes_de_cours/section_2.4/#exemple-de-difference-de-dates","title":"Exemple de diff\u00e9rence de dates","text":"<p>Par exemple, on peut exprimer la longueur d'une session en terme de jours, mais cela n'est pas toujours parlant.</p> <pre><code>SELECT semestre, annee, \n    datediff(fin_session, debut_session) AS nombre_jours \n    FROM sessions;\n</code></pre> <p></p>"},{"location":"notes_de_cours/section_2.4/#construire-une-date-a-partir-dun-nombre-de-jour","title":"Construire une date \u00e0 partir d'un nombre de jour","text":"<p>La fonction from_days permet de construire la date \u00e0 partir d'un nombre de jours.</p> <p>Toutefois, cette fonction ne devrait pas \u00eatre utilis\u00e9e si le r\u00e9sultat est hors des limites habituels des dates.</p>"},{"location":"notes_de_cours/section_2.4/#difference-de-datetime","title":"Diff\u00e9rence de DATETIME ?","text":"<p>Il n\u2019y a pas de fonction qui retourne l\u2019addition ou diff\u00e9rence de DATETIME. La partie de date et du temps doivent \u00eatre trait\u00e9s s\u00e9par\u00e9ment.</p>"},{"location":"notes_de_cours/section_2.4/#addition-de-temps","title":"Addition de temps","text":"<p>Pour ajouter du temps \u00e0 un type TIME on utilise la fonction addtime.</p> <p>Cette fonction ajoute deux types time ensemble.</p> <pre><code>addtime ('00:02:15', '00:03:18') \n-- retourne 0 h 5 m 33 s\n</code></pre>"},{"location":"notes_de_cours/section_2.4/#addition-de-date","title":"Addition de date","text":"<p>La fonction adddate ajoute un intervalle \u00e0 un type DATE ou \u00e0 un type DATETIME. On inscrit un intervalle avec la syntaxe suivante.</p> <pre><code>INTERVAL nombre UNITE\n</code></pre> <p>Les unit\u00e9s possibles sont YEAR, MONTH, WEEK, DAY, HOUR, MINUTE, SECOND  https://dev.mysql.com/doc/refman/8.0/en/expressions.html#temporal-intervals</p> <p>Pour ajouter une journ\u00e9e \u00e0 la date du 15 janvier 2022.</p> <pre><code>adddate ('2022-01-15', INTERVAL 1 DAY) \n-- retourne 2022-01-16\n</code></pre>"},{"location":"notes_de_cours/section_2.4/#soustraction-de-date","title":"Soustraction de date","text":"<p>Pour soustraire un intervalle \u00e0 un type DATE ou DATETIME, on peut utiliser la fonction subdate.</p> <p>Cette fonction s\u2019utilise exactement comme adddate.</p>"},{"location":"notes_de_cours/section_2.4/#-exercice-241-","title":"--- Exercice 2.4.1 ---","text":"<p>On veut le titre des documents qui : A. ont \u00e9t\u00e9 remis au mois de mai B. ont \u00e9t\u00e9 remis dans les deux derni\u00e8res ann\u00e9es  </p> <p>On veut le semestre et l'ann\u00e9e des sessions qui : C. Durent plus de 17 semaines  </p>"},{"location":"notes_de_cours/section_2.4/#manipulation-de-timestamp","title":"Manipulation de timestamp","text":"<p>Deux fonctions permettent la manipulation des timestamps:</p> <ul> <li>timestampadd</li> <li>timestampdiff</li> </ul> <p>Les fonctions addition ou soustraient 2 timestamp et retournent la valeur sous forme de l\u2019unit\u00e9 indiqu\u00e9e.</p> <p>Obtenir l\u2019addition de 3 minutes \u00e0 l\u2019heure actuelle :</p> <pre><code>timestampadd (MINUTE, 3, current_timestamp())\n</code></pre> <p>Obtenir le nombre de jours avant No\u00ebl.</p> <pre><code>timestampdiff (DAY, '2022-12-25', current_timestamp ())\n</code></pre>"},{"location":"notes_de_cours/section_2.4/#gestion-des-fuseaux-horaires","title":"Gestion des fuseaux horaires","text":"<p>MySQL offre plusieurs fonctions pour g\u00e9rer des informations de diff\u00e9rents fuseaux horaires.</p> <p>Toutes les fonctions de manipulation du temps sont d\u00e9crites ici:</p> <p>https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html</p>"},{"location":"notes_de_cours/section_2.4/#curiosite-de-date","title":"Curiosit\u00e9 de date","text":"<p>Il y a longtemps, le calendrier Julien (de Jules C\u00e9sar) a \u00e9t\u00e9 introduit avec une semaine  jours et des cycles annuels bas\u00e9s sur le Soleil. Malheureusement, avec l'exactitude des m\u00e9thodes de mesure de l'\u00e9poque, l'ann\u00e9e julienne devait \u00eatre corrig\u00e9e.</p> <p>En 1582, le monde occidental a pass\u00e9 au calendrier Gr\u00e9gorien (demande du pape Gr\u00e9goire XIII). qui r\u00e9gularise les ann\u00e9es et les dur\u00e9es des jours en introduisant les ann\u00e9es bisextiles (sur un cycle de 400 ans).</p> <p>Par contre, le passage a demand\u00e9 un ajustement particulier...</p>"},{"location":"notes_de_cours/section_2.4/#correction-doctobre-1582","title":"Correction d'octobre 1582","text":"<p>Voici le calendrier du mois d'octobre 1582. Les 10 jours supprim\u00e9s sont entre autre les 9 ann\u00e9es bissextile en trop entre le sixi\u00e8me et le seizi\u00e8me si\u00e8cle (500, 600, 700, 900, 1000, 1100, 1300, 1400 et 1500). </p> <p></p>"},{"location":"notes_de_cours/section_2.4/#calendrier-gregorien-proleptique","title":"Calendrier Gr\u00e9gorien proleptique","text":"<p>Un tel calendrier est un calendrier Gr\u00e9gorien r\u00e9tropoler \u00e0 partir d'aujourd'hui. Les dates retir\u00e9es dans la correction sont inclues dans le calendrier Gr\u00e9gorien proleptique. </p> <p>Il s'agit de ce calendrier que MySQL utilise, donc les dates retir\u00e9es sont valides (exemple 8 octobre 1582), m\u00eame si elles n'ont jamais r\u00e9ellement exist\u00e9es. </p>"},{"location":"notes_de_cours/section_2.5/","title":"Jointures et agr\u00e9gats","text":"<p>Jointures internes Jointures naturelles Atelier Agr\u00e9gats de donn\u00e9es Atelier</p>"},{"location":"notes_de_cours/section_2.5/#probleme","title":"Probl\u00e8me","text":"<p>Pour chaque programme, on veut afficher le nom du programme et le nom de la personne responsable. On aurait un r\u00e9sultat du format suivant</p> Nom programme Nom responsable Informatique appliqu\u00e9e Bruce Wayne Informatique - Jeux Vid\u00e9o Kara Danvers <p>Le probl\u00e8me : nom programme et nom professeur sont dans deux tables diff\u00e9rentes.</p>"},{"location":"notes_de_cours/section_2.5/#relation-programme-enseignant","title":"Relation Programme - Enseignant","text":"<pre><code>erDiagram  \n    enseignants ||--o{ programmes : \" \" \n    enseignants {\n        NUMERIC(8) code_employe\n        VARCHAR(255) nom\n        VARCHAR(255) prenom\n        NUMERIC(9) num_assurance_sociale\n        TINYINT anciennete\n    }\n    programmes {\n        INTEGER code PK\n        VARCHAR(255) nom\n        NUMERIC(8) responsable FK\n    }</code></pre>"},{"location":"notes_de_cours/section_2.5/#jointures","title":"Jointures","text":"<p>Une jointure permet de \u00ab joindre \u00bb deux tables ensemble pour en cr\u00e9er une seule. Ici la table r\u00e9sultant n'est pas une \u00ab vraie \u00bb table au sens o\u00f9 elle n'est pas enregistrer dans la base de donn\u00e9es.</p> <p>Il existe 3 types de jointures : - Jointures internes et naturelles (vues en BD1) - Jointures \u00e0 gauche et \u00e0 droite (vues en BD2) - Jointures externes ou compl\u00e8tes (vues en BD2)</p>"},{"location":"notes_de_cours/section_2.5/#jointures-internes","title":"Jointures internes","text":"<p>Une jointure interne permet de r\u00e9cup\u00e9rer les informations en croisant les informations de plusieurs tables. </p> <p>On peut voir la jointure interne comme une intersection d'ensembles bas\u00e9 sur l'\u00e9galit\u00e9 d'une paire de colonnes.</p> <p></p>"},{"location":"notes_de_cours/section_2.5/#syntaxe-des-jointures-internes","title":"Syntaxe des jointures internes","text":"<pre><code>SELECT * FROM Nom_table_1 INNER JOIN Nom_table_2 \n    ON Nom_table_1.colonne_1 = Nom_table_2.colonne_2;\n</code></pre> <p>Donc dans l'exemple pr\u00e9c\u00e9dent</p> <pre><code>SELECT Programme.nom, Enseignant.nom FROM Enseignant INNER JOIN Programme\n    ON Enseignant.code_employe = Programme.responsable;\n</code></pre> <p>On pr\u00e9fixe les colonnes des noms de table pour \u00e9viter les ambiguit\u00e9 de nom.</p>"},{"location":"notes_de_cours/section_2.5/#allegement-de-lecriture","title":"All\u00e8gement de l'\u00e9criture","text":"<p>Lorsqu'il n'y a pas de risque d'ambiguit\u00e9 de nom, on peut omettre le nom des tables comme pr\u00e9fixe. On peut aussi utiliser les alias pour clarifier le nom des colonnes.</p> <pre><code>SELECT Programme.nom AS 'Nom programme', Enseignant.nom AS 'Responsable' \n    FROM Enseignant INNER JOIN Programme\n    ON code_employe = responsable;\n</code></pre> <p></p>"},{"location":"notes_de_cours/section_2.5/#-exercice-251-","title":"--- Exercice 2.5.1 ---","text":"<p>A. S\u00e9lectionnez le nom de chaque \u00e9tudiant et le nom du programme dans lequel il est inscrit. Triez les r\u00e9sultats par programme.</p> <p>B. S\u00e9lectionnez pour chaque document le code de l'\u00e9tudiant qui l'a remis. Affichez le nom du document et le code de l'\u00e9tudiant.</p>"},{"location":"notes_de_cours/section_2.5/#jointure-naturelle","title":"Jointure naturelle","text":"<p>Une jointure naturelle fonctionne comme la jointure interne, mais ne n\u00e9cessite pas de pr\u00e9ciser sur quelle colonne se fait la jointure.</p> <p>Les colonnes portant le m\u00eame nom entre les 2 tables servent \u00e0 effectuer la jointure. </p> <p>ATTENTION : si plus d'une paire de colonne portent le m\u00eame nom, alors la jointure naturelle v\u00e9rifira que les deux paires concordent.</p> <p>Syntaxe de la jointure naturelle :</p> <pre><code>SELECT * FROM Nom_table_1 NATURAL JOIN Nom_table_2;\n</code></pre> <p>On veut afficher le code d'employ\u00e9 et le sigle du cours pour chaque groupe. </p> <pre><code>SELECT enseignant, numero_groupe, sigle \n    FROM groupes NATURAL JOIN cours;\n</code></pre> <p></p> <pre><code>\nerDiagram  \n    cours ||--o{ groupes : \" \" \n    cours {\n        INTEGER cours_id PK\n        NUMERIC(8) enseignant FK\n        CHAR(11) sigle\n        TINYINT duree \"=60\"\n        VARCHAR(255) nom\n    }\n    groupes {\n        INTEGER groupe_id PK\n        INTEGER session FK \n        INTEGER cours_id FK\n        NUMERIC(8) enseignant FK \n        TINYINT numero_groupe\n    }</code></pre>"},{"location":"notes_de_cours/section_2.5/#-exercice-252-","title":"--- Exercice 2.5.2 ---","text":"<p>A. S\u00e9lectionnez le titre des \u00e9valuations pour lequel aucun document n'est associ\u00e9.  A  B. S\u00e9lectionnez l'ann\u00e9e admission et le nom de l'\u00e9tudiant pour chaque \u00e9tudiant des programmes sous la responsabilit\u00e9 de l'enseignant portant le code 7654.</p>"},{"location":"notes_de_cours/section_2.5/#probleme_1","title":"Probl\u00e8me","text":"<p>On veut afficher pour chaque \u00e9tudiant son nom, le titre des documents qu'il a remis et la date \u00e0 laquelle la remise s'est faite.</p> <p>Quelle requ\u00eate \u00e9crire ?</p>"},{"location":"notes_de_cours/section_2.5/#jointures-multiples","title":"Jointures multiples","text":"<p>On peut appliquer une jointure sur le r\u00e9sultat d'une jointure.</p> <pre><code>SELECT nom, titre, date_remise FROM etudiants\n    INNER JOIN evaluations_etudiants ON code = etudiant\n    INNER JOIN documents ON document = document_id;\n</code></pre> <p></p> <p>44 lignes ont \u00e9t\u00e9 s\u00e9lectionn\u00e9es.</p>"},{"location":"notes_de_cours/section_2.5/#-exercice-253-","title":"--- Exercice 2.5.3 ---","text":"<p>A. S\u00e9lectionnez pour l'\u00e9tudiante Nathasha Romanov le titre de tous les documents qu'elle a remis.</p> <p>B. Trouvez la premi\u00e8re ann\u00e9e durant laquelle le cours portant le sigle 420-2B4-VI s'est donn\u00e9.  </p>"},{"location":"notes_de_cours/section_2.5/#agregats","title":"Agr\u00e9gats","text":"<p>Il est possible d\u2019agr\u00e9ger des donn\u00e9es ensemble. Un agr\u00e9gat consiste \u00e0 regrouper les donn\u00e9es qui partagent une valeur commune pour une colonne pr\u00e9cise. On fait un agr\u00e9gat avec une clause GROUP BY.</p> <p>On utilise g\u00e9n\u00e9ralement une fonction d'agr\u00e9gation avec un agr\u00e9gat pour obtenir des informations sur le groupe.</p> <p>Il faut faire attention dans la s\u00e9lection des colonnes pour n'afficher que des colonnes qui ont la m\u00eame valeur pour tout le groupe.</p>"},{"location":"notes_de_cours/section_2.5/#exemple","title":"Exemple","text":"<p>S\u00e9lectionner le nombre d'\u00e9tudiant dans chaque groupe.</p> <pre><code>SELECT groupe, count(etudiant) FROM Inscription \n    GROUP BY groupe;\n</code></pre> <p></p> <p></p>"},{"location":"notes_de_cours/section_2.5/#-exercice-254-","title":"--- Exercice 2.5.4 ---","text":"<p>A. Comptez le nombre d'\u00e9valuations pour chaque groupe. Affichez seulement l'id du groupe et le nombre d'\u00e9valuations.</p> <p>B. Comptez le nombre de groupes pour chaque session. Affichez le nombre de groupe, le semestre et l'ann\u00e9e de chaque session.</p>"},{"location":"notes_de_cours/section_2.5/#agregats-multiples","title":"Agr\u00e9gats multiples","text":"<p>Il est possible de former les agr\u00e9gats par plusieurs crit\u00e8res. Par exemple, on souhaite obtenir le nombre de document remis pour chaque \u00e9tudiant par groupe.</p> <pre><code>SELECT count(id_document), etudiant, groupe FROM Document \n    INNER JOIN EvaluationEtudiant ON id_document = document\n    INNER JOIN Evaluation ON EvaluationEtudiant.id_evaluation = Evaluation.id_evaluation\n    GROUP BY etudiant, groupe;\n</code></pre> <p></p>"},{"location":"notes_de_cours/section_2.5/#-exercice-255-","title":"--- Exercice 2.5.5 ---","text":"<p>S\u00e9lectionnez pour chaque cours le nombre de fois qu'il s'est donn\u00e9 \u00e0 chaque session (nombre de groupes). Affichez le semestre, l'ann\u00e9e de la session ainsi que le sigle du cours. Triez les r\u00e9sultats par sigle.</p>"},{"location":"notes_de_cours/section_2.5/#condition-sur-les-groupes","title":"Condition sur les groupes","text":"<p>Il est possible de mettre une condition sur un groupe. Une telle condition va dans une clause HAVING.</p> <p>DINSTINCTION IMPORTANTE :</p> <ul> <li> <p>Une condition portant sur chaque enregistrement  (avant agr\u00e9gation) : WHERE</p> </li> <li> <p>Une condition portant sur un agr\u00e9gat de donn\u00e9es  (avec une fonction d'agr\u00e9gation) : HAVING</p> </li> </ul>"},{"location":"notes_de_cours/section_2.5/#exemple_1","title":"Exemple","text":"<p>On veut les groupes de 3 \u00e9tudiants et plus :</p> <pre><code>SELECT groupe, count(etudiant) FROM Inscription\n    GROUP BY groupe\n    HAVING count(etudiant) &gt;= 3;\n</code></pre> <p></p>"},{"location":"notes_de_cours/section_2.5/#exemple-alias","title":"Exemple : Alias","text":"<p>On peut utiliser les alias pour \u00e9viter de r\u00e9\u00e9crire plusieurs fois le r\u00e9sultat d'une m\u00eame fonction.</p> <pre><code>SELECT groupe, count(etudiant) AS nombre_etudiants FROM Inscription\n    GROUP BY groupe\n    HAVING nombre_etudiants &gt;= 3;\n</code></pre> <p>Notez bien : le nom nombre_etudiants est inscrit tel quel sans guillemet, c'est pourquoi il est accessible. Avec des guillemets, cela aurait chang\u00e9 l'affichage, mais nous n'aurions pas pu l'utiliser dans la clause HAVING.</p>"},{"location":"notes_de_cours/section_2.5/#-exercice-256-","title":"--- Exercice 2.5.6 ---","text":"<p>A. S\u00e9lectionnez le nombre de cours pour chaque session (id_session seulement) o\u00f9 il ne se donne pas plus de 2 cours;</p> <p>B. S\u00e9lectionnez le nombre d'\u00e9tudiants admis par ann\u00e9e apr\u00e8s 2019.</p>"},{"location":"notes_de_cours/section_2.5/#selection-unique","title":"S\u00e9lection unique","text":"<p>Dans certains cas, en combinant les jointures avec les agr\u00e9gats, on peut dupliquer des r\u00e9sultats.</p> <p>Pour s'assurer que les r\u00e9sultats ne sont pas dupliquer, on doit utiliser le mot-cl\u00e9 DISTINCT. On peut utiliser le mot-cl\u00e9 de deux fa\u00e7ons</p> <pre><code>-- Dans une requ\u00eate SELECT pour avoir que les valeurs diff\u00e9rentes\nSELECT DISTICT colonne\n\n-- Dans la fonction count pour compter le nombre de valeurs distinctes\ncount(DISTINCT colonne)\n</code></pre>"},{"location":"notes_de_cours/section_2.5/#-exercice-257-","title":"--- Exercice 2.5.7 ---","text":"<p>S\u00e9lectionnez les sigle des cours ayant plus de 2 \u00e9valuations lorsqu'ils se sont donn\u00e9s. Chaque sigle doit appara\u00eetre qu'une seule fois.</p>"},{"location":"notes_de_cours/section_2.6/","title":"Fonctions statistiques et filtrage","text":"<p>Fonctions statistiques Op\u00e9rateurs d'ensemble Atelier</p> <p>Plusieurs fonctions statistiques existent dans les agr\u00e9gats.</p> <p>On a d\u00e9j\u00e0 vu la fonction count qui permet de compter le nombre d\u2019enregistrements.</p> <p>On peut utiliser les fonctions statistiques hors des agr\u00e9gats de donn\u00e9es. Par contre, la restriction aux colonnes non agr\u00e9g\u00e9es s\u2019applique.</p>"},{"location":"notes_de_cours/section_2.6/#fonctions-statistiques","title":"Fonctions statistiques","text":"<p>Sauf pour count, les fonctions sont  appell\u00e9es sur des colonnes de type num\u00e9rique.</p> Fonction Op\u00e9ration sum(nom_colonne) Somme les valeurs de la liste min(nom_colonne) Trouve la valeur minimale parmi la liste max(nom_colonne) Trouve la valeur maximale parmi la liste avg(nom_colonne) Calcule la valeur moyenne de la liste count(nom_colonne) Compte le nombre de valeurs de la liste std(nom_colonne) Calcule l'\u00e9cart-type des valeurs de la liste"},{"location":"notes_de_cours/section_2.6/#trouver-le-minimum","title":"Trouver le minimum","text":"<p>Affichez la note minimale qu\u2019un \u00e9tudiant a obtenue \u00e0 l\u2019\u00e9valuation portant l\u2019id 5.</p> <pre><code>SELECT min(note) FROM Evaluation_etudiant\n    WHERE id_evaluation = 5;\n</code></pre>"},{"location":"notes_de_cours/section_2.6/#-exercice-261-","title":"--- Exercice 2.6.1 ---","text":"<p>A. S\u00e9lectionnez la valeur de la plus haute note obtenue \u00e0 l'\u00e9valuation 18.</p> <p>B. S\u00e9lectionnez le nom de l'\u00e9tudiant ayant obtenu la plus haute note \u00e0 l'\u00e9valuation 18.</p> <p>C. S\u00e9lectionnez la note totale de l'\u00e9tudiant 1234567 au groupe 5.</p> <p>D. S\u00e9lectionnez la moyenne (en pourcentage) de l'\u00e9valuation 13.</p>"},{"location":"notes_de_cours/section_2.6/#afficher-toutes-les-valeurs","title":"Afficher toutes les valeurs","text":"<p>Pour s'aider dans le debogage, on peut afficher le contenu d'un groupe. La fonction qui permet cela est GROUP_CONCAT.</p> <p>Par exemple, voici le nom des \u00e9tudiants inscrit au programme 420.A0.</p> <pre><code>SELECT GROUP_CONCAT (Etudiant nom), Programme.nom, FROM Etudiant \n    INNER JOIN Programme ON programme = Programme.code \n    WHERE Programme.code = '420.A0';\n</code></pre>"},{"location":"notes_de_cours/section_2.6/#operateurs-densemble","title":"Op\u00e9rateurs d'ensemble","text":"<p>Des op\u00e9rateurs existent sur les ensembles pour simplifier les requ\u00eates de s\u00e9lection.</p> <p>Deux op\u00e9rateurs existent : - BETWEEN - IN</p>"},{"location":"notes_de_cours/section_2.6/#between","title":"Between","text":"<p>Le mot-cl\u00e9 BETWEEN permet de chercher un enregistrement entre deux valeurs.</p> <pre><code>... WHERE nom_colonne BETWEEN minimum AND maximum\n\n-- \u00e9quivalent \u00e0\n\n... WHERE nom_colonne &gt;= minimum AND nom_colonne &lt;= maximum\n</code></pre>"},{"location":"notes_de_cours/section_2.6/#negation","title":"N\u00e9gation","text":"<p>On peut appliquer la n\u00e9gation avec l'op\u00e9rateur NOT \u00e0 l'op\u00e9rateur BETWEEN pour signifier toutes les valeurs sauf celles dans cet interval. La syntaxe est :</p> <pre><code>... WHERE nom_colonne NOT BETWEEN minimum AND maximum\n</code></pre>"},{"location":"notes_de_cours/section_2.6/#in","title":"IN","text":"<p>Pour v\u00e9rifier si la colonne correspond \u00e0 une valeur parmi une liste, on peut utiliser l\u2019op\u00e9rateur IN.</p> <pre><code>... WHERE nom_colonne IN (valeur1, valeur2 \u2026)\n\n-- \u00e9quivalent \u00e0\n\n... WHERE nom_colonne = valeur1 OR nom_colonne = valeur2 OR \u2026\n</code></pre>"},{"location":"notes_de_cours/section_2.6/#in-avec-negation","title":"IN avec N\u00e9gation","text":"<p>On peut aussi utiliser l'op\u00e9rateur de n\u00e9gation NOT devant l'op\u00e9rateur IN pour s\u00e9lectionner toutes les valeurs sauf celles dans l\u2019intervalle.</p> <pre><code>... WHERE nom_colonne NOT IN (valeur1, valeur2, ...)\n</code></pre>"},{"location":"notes_de_cours/section_2.6/#-exercice-262-","title":"--- Exercice 2.6.2 ---","text":"<p>S\u00e9lectionnez le nom des \u00e9tudiants qui ont suivi au moins l'un des cours suivants :</p> <ul> <li>420-1D6-VI</li> <li>420-2B4-VI</li> <li>420-2A6-VI</li> </ul> <p>S\u00e9lectionnez les documents remis avant le 16 octobre 2020 ou apr\u00e8s la fin de la session automne 2020 (19 d\u00e9cembre 2020)</p>"},{"location":"notes_de_cours/section_3.1/","title":"3.1 \u00c9tablir une strat\u00e9gie de sauvegarde de la BD","text":"<p>\u00c9tablir une strat\u00e9gie de sauvegarde de la BD</p>"},{"location":"notes_de_cours/section_3.1/#pourquoi-sauvegarder-une-bd","title":"Pourquoi sauvegarder une BD?","text":"<p>Pouvoir restaurer la BD dans les cas de :</p> <ul> <li>Destruction accidentelle (DROP *)</li> <li>Bris de serveur (usure/Ti-Guy qui a encore \u00e9chapp\u00e9 son caf\u00e9)</li> <li>Attaque de pirates (ex.: ran\u00e7ongiciel)</li> <li>Manipulation erron\u00e9e (ex. par du d\u00e9veloppement)</li> <li>R\u00e9cr\u00e9er les donn\u00e9es suite \u00e0 changement d\u2019environnement (mise \u00e0 jour MySQL)</li> <li>Pour un passage d'un environnement de tests \u00e0 un d\u00e9ploiement en production</li> <li>Catastrophe naturelle, incendie, m\u00e9t\u00e9orite ou invasion d\u2019extra-terrestres </li> </ul>"},{"location":"notes_de_cours/section_3.1/#importance-de-la-sauvegarde","title":"Importance de la sauvegarde","text":"<p>Une perte de donn\u00e9es co\u00fbte en moyenne entre 4,4 millions au Canada (2021).</p> <p>Selon certains fournisseurs de stockage, jusqu\u2019\u00e0 la moiti\u00e9 des entreprises perdront des donn\u00e9es au cours de leurs op\u00e9rations.</p>"},{"location":"notes_de_cours/section_3.1/#la-strategie-3-2-1","title":"La strat\u00e9gie 3-2-1","text":"<p>Pr\u00e9sent\u00e9e comme un standard, la r\u00e8gle du 3-2-1 est la suivante:</p> <ul> <li>3 copies de chaque donn\u00e9e</li> <li>2 copies \u00abonsite\u00bb (sur le m\u00eame lieu physique)</li> <li>1 copie \u00aboffsite\u00bb (dans un emplacement physique diff\u00e9rent)</li> </ul>"},{"location":"notes_de_cours/section_3.1/#etapes-dune-strategie-de-sauvegarde","title":"\u00c9tapes d\u2019une strat\u00e9gie de sauvegarde","text":"<ol> <li> <p>D\u00e9terminer les donn\u00e9es \u00e0 sauvegarder?</p> </li> <li> <p>Qu\u2019est-ce qui est critique?</p> <ul> <li>Grouper par groupe : critique pour survivre, important pour op\u00e9rer, optimal pour le d\u00e9veloppement</li> </ul> </li> <li> <p>Qu\u2019est-ce qui est suffisamment important pour investir dans sa sauvegarde?</p> <ul> <li>Dans cette question, \u00e9valuez le rapport quantit\u00e9/co\u00fbt. Faire une sauvegarde de Facebook (+/- 100 Po) est plus lourd qu\u2019une sauvegarde de Wikip\u00e9dia (+/- 10TB).</li> </ul> </li> <li> <p>D\u00e9terminer la fr\u00e9quence des sauvegardes?</p> </li> <li> <p>Sauvegardes p\u00e9riodiques (quotidienne, hebdomadaire)</p> <ul> <li>Quelle quantit\u00e9 de travail on peut se permettre de perdre?</li> </ul> </li> <li> <p>Sauvegarde exceptionnelle</p> <ul> <li>Quand ces sauvegardes sont-elles requises?</li> </ul> </li> <li> <p>Choisir et mettre en place une strat\u00e9gie</p> </li> <li> <p>Pr\u00e9parer deux serveurs locaux (2)</p> </li> <li>Pr\u00e9parer un serveur distance/souscrire \u00e0 un service (1)</li> <li>D\u00e9crire un syst\u00e8me d\u2019organisation des sauvegardes<ul> <li>Nomenclature/emplacement logiciel</li> </ul> </li> <li>Mettre en place une routine de sauvegarde (p\u00e9riodique)</li> <li> <p>Mettre en place une proc\u00e9dure de sauvegarde exceptionnelle</p> </li> <li> <p>Tester (r\u00e9guli\u00e8rement) et assurer la maintenance</p> </li> <li> <p>Ne pas tenter la loi de Murphy/loi de l\u2019emmerdement maximal</p> </li> <li>La journ\u00e9e que vous avez besoin de restaurer la sauvegarde, il y a int\u00e9r\u00eat \u00e0 ce que \u00e7a fonctionne</li> <li>Tenez compte des modifications aux structures de donn\u00e9es<ul> <li>Avec l\u2019\u00e9volution du projet, la strat\u00e9gie de sauvegarde doit \u00e9voluer</li> </ul> </li> </ol>"},{"location":"notes_de_cours/section_3.1/#types-de-sauvegarde","title":"Types de sauvegarde","text":"<ul> <li>Sauvegarde compl\u00e8te<ul> <li>Cr\u00e9e une copie compl\u00e8te de toutes les donn\u00e9es</li> <li>Pour : facile \u00e0 mettre en place et diminue les risques d\u2019incoh\u00e9rence \u00e0 la restauration</li> <li>Contre : demande beaucoup d\u2019espace de stockage, car duplique l\u2019information</li> </ul> </li> <li>Sauvegarde diff\u00e9rentielle<ul> <li>Cr\u00e9e une copie seulement des changements</li> <li>Pour : ne duplique pas l\u2019information de sauvegarde</li> <li>Contre : syst\u00e8me de restauration plus complexe qui peut s\u2019effondrer si l\u2019historique est corrompu.</li> </ul> </li> </ul>"},{"location":"notes_de_cours/section_3.2/","title":"Sauvegarder et restaurer une BD","text":"<p>Dumping Charger une sauvegarde Dumping dans un format texte Charger des donn\u00e9es d\u2019un format texte</p>"},{"location":"notes_de_cours/section_3.2/#dumping","title":"Dumping","text":"<p>Le \u00abdumping\u00bb consiste \u00e0 g\u00e9n\u00e9rer le code SQL pour recr\u00e9er compl\u00e8tement la base de donn\u00e9es (CREATE DATABASE, TABLE et INSERT INTO).</p> <p>Ce fichier comporte de nombreuses instructions SQL suppl\u00e9mentaires pour assurer que les donn\u00e9es sont restaur\u00e9es normalement.</p> <p>Dans une invite de commande situ\u00e9e l\u00e0 o\u00f9 votre ex\u00e9cutable MySQL est plac\u00e9, entrez la commande suivante (Windows)</p> <pre><code>.\\mysqldump.exe --databases nom1 nom2 \u2026 &gt; chemin/fichier.sql \u2013unom_utilisateur \u2013p\n</code></pre> <p>Exemple : <pre><code>.\\mysqldump.exe --databases ecole \u2026 &gt; ../ecole_backup.sql \u2013uroot \u2013p\n```` \n\nPuis saisissez le mot de passe du compte.\n\nDans le r\u00e9pertoire parent, vous trouverez le fichier ecole_backup.sql.\n\nPour exporter toutes les bases de donn\u00e9es, on remplace \n\u00ab--databases nom1\u00bb par \u00ab--all-databases\u00bb\n\nOn peut omettre l\u2019option databases si l\u2019on en exporte qu\u2019une\n\n```console\n.\\mysqldump.exe nom_db &gt; chemin/fichier.sql \u2013unom_utilisateur \u2013p\n</code></pre></p>"},{"location":"notes_de_cours/section_3.2/#charger-une-bd-a-partir-dun-fichier-de-sauvegarde","title":"Charger une BD \u00e0 partir d\u2019un fichier de sauvegarde","text":"<p>Pour charger la BD, c\u2019est simple : il suffit d\u2019ex\u00e9cuter le script mysql!</p> <p>Soit \u00e0 travers Workbench ou avec l'invite de commandes</p> <pre><code>mysql &lt; fichier.sql\n</code></pre>"},{"location":"notes_de_cours/section_3.2/#table-corrompue","title":"Table corrompue","text":"<p>Une instruction permet de r\u00e9cup\u00e9rer les donn\u00e9es d\u2019une table dont le fichier de sauvegarde serait corrompu.</p> <pre><code>REPAIR TABLE Nom_table EXTENDED;\n</code></pre> <p>https://dev.mysql.com/doc/refman/8.0/en/repair-table.html</p>"},{"location":"notes_de_cours/section_3.2/#dumping-dans-un-fichier-texte","title":"Dumping dans un fichier texte","text":"<p>Il est possible d\u2019exporter le contenu des tables dans des fichiers de format texte afin de les lire avec d\u2019autres logiciels.</p> <p>On trouve notamment le format Comma Separeted Values lisible par Excel. </p>"},{"location":"notes_de_cours/section_3.2/#le-format-csv","title":"Le format CSV","text":"<p>Le format CSV vient avec un standard fran\u00e7ais et anglais (avec un simple logiciel comme Notepad++ et une toute petite REGEX, vous pouvez facilement effectuer la conversion)</p> <ul> <li>Standard anglais : s\u00e9parateur de colonne \u00ab,\u00bb</li> <li>Standard fran\u00e7ais : s\u00e9parateur de colonne \u00ab;\u00bb</li> </ul> <p>S\u00e9parateur de ligne : (r)n (retour de ligne) Encapsulation des cha\u00eenes de caract\u00e8re \" \"</p> id_personne nom prenom 2 Shutt Steve 5 Stastny Peter 7 Dryden Ken <p>Format anglais Id_personne,nom,prenom 2,Shutt,Steve 5,Stastny,Peter 7,Dryden,Ken</p> <p>Format fran\u00e7ais Id_personne;nom;prenom 2;Shutt;Steve 5;Stastny;Peter 7;Dryden;Ken</p>"},{"location":"notes_de_cours/section_3.2/#exporter-vers-csv","title":"Exporter vers CSV","text":"<p>Par d\u00e9faut, l\u2019exportation s\u00e9pare les colonnes par une tabulation.</p> <pre><code>SELECT colonnes INTO OUTFILE 'nom_fichier'\n    FIELDS TERMINATED BY ',' \n    OPTIONALLY ENCLOSED BY '\"'\n    LINES TERMINATED BY '\\n'\n    FROM nom_table;\n</code></pre> <p>Une instruction existe aussi \u00e0 partir de l\u2019invite de commande.</p>"},{"location":"notes_de_cours/section_3.2/#gestion-de-droits","title":"Gestion de droits","text":"<p>Par d\u00e9faut (et pour d\u2019\u00e9videntes raisons de s\u00e9curit\u00e9), MySQL limite les endroits o\u00f9 il est possible d\u2019exporter un fichier texte.</p> <p>Dans votre fichier my.ini, il faut ajouter l\u2019instruction suivante </p> <p>[mysqld] secure_file_priv = \"\"</p> <p>N\u2019oubliez de red\u00e9marrez mysql apr\u00e8s.</p>"},{"location":"notes_de_cours/section_3.2/#charger-a-partir-dun-fichier-csv","title":"Charger \u00e0 partir d'un fichier CSV","text":"<p>Pour lire un fichier CSV, on utilise l\u2019instruction suivante:</p> <pre><code>LOAD DATA INFILE 'nom_fichier' \n    INTO TABLE Nom_table\n    FIELDS TERMINATED BY ',' \n    FIELDS ENCLOSED BY '\"'\n    LINES TERMINATED BY '\\r\\n';\n</code></pre> <p>Une instruction existe aussi \u00e0 partir de l\u2019invite de commande.</p>"},{"location":"notes_de_cours/section_3.3/","title":"Automatisation des sauvegardes","text":""},{"location":"notes_de_cours/section_3.3/#script-bat","title":"Script bat","text":"<p>Le script bat permet de programmer un script s\u2019ex\u00e9cutant dans l\u2019invite de commande. C\u2019est \u00e0 peu pr\u00e8s l\u2019\u00e9quivalent Windows des scripts bash des environnements UNIX.</p>"},{"location":"notes_de_cours/section_3.3/#sauvegarder-la-base-de-donnees","title":"Sauvegarder la base de donn\u00e9es","text":"<p>Contenu du fichier .bat:</p> <p>:: declaration variable SET \"date=%DATE:/=-%\"</p> <p>:: instructions ECHO ================ ECHO Sauvegarde auto ECHO ================ I:ProgrammesAmppsmysqlbinmysqldump.exe --all-databases &gt; C:UsersAlexandreDesktopbackup_%date%.sql -uroot -pmysql ECHO Sauvegarde realisee avec succes</p>"},{"location":"notes_de_cours/section_3.3/#appeler-le-script","title":"Appeler le script","text":"<p>Maintenant, plus qu\u2019\u00e0 double cliquer sur le script bat pour qu\u2019il s\u2019ex\u00e9cute.</p> <p></p>"},{"location":"notes_de_cours/section_3.3/#programmer-la-tache","title":"Programmer la t\u00e2che","text":"<p>Avec le planificateur de t\u00e2che Windows (Task Scheduler), vous pouvez indiquer \u00e0 Windows de d\u00e9marrer une t\u00e2che \u00e0 un moment donn\u00e9.</p> <p>Une t\u00e2che peut consister \u00e0 ex\u00e9cuter un script bat par exemple.</p> <p>Le planificateur se trouve dans \u00ab Outils d\u2019administration Windows \u00bb </p> <p></p>"},{"location":"notes_de_cours/section_4.1/","title":"Int\u00e9grit\u00e9 des donn\u00e9es","text":""},{"location":"notes_de_cours/section_4.1/#contraintes-dintegrite","title":"Contraintes d\u2019int\u00e9grit\u00e9","text":"<p>Une contrainte d\u2019int\u00e9grit\u00e9 est une condition \u00e0 v\u00e9rifier sur un enregistrement afin de maintenir son int\u00e9grit\u00e9 (qu'elle contienne une valeur qui a un sens). G\u00e9n\u00e9ralement, une contrainte d\u2019int\u00e9grit\u00e9 a pour effet de restreindre les valeurs possibles d\u2019une colonne.</p>"},{"location":"notes_de_cours/section_4.1/#cle-primaire-cle-etrangere-et-valeur-par-defaut","title":"Cl\u00e9 primaire, cl\u00e9 \u00e9trang\u00e8re et valeur par d\u00e9faut","text":"<p>Les contraintes cl\u00e9 primaire, cl\u00e9 \u00e9trang\u00e8re et valeur par d\u00e9faut ont d\u00e9j\u00e0 \u00e9t\u00e9 couvertes. On a pu voir que certaines sont sp\u00e9cifi\u00e9es directement dans la d\u00e9claration d\u2019une colonne (DEFAULT, PRIMARY KEY), tandis que d\u2019autres sont sp\u00e9cifi\u00e9s sur leur ligne \u00e0 part (FOREIGN KEY, PRIMARY KEY). Ajouter un enregistrement ne respectant pas la contrainte d\u00e9clenche une erreur.</p>"},{"location":"notes_de_cours/section_4.1/#rappel-des-contraintes","title":"Rappel des contraintes","text":"<p>Cl\u00e9 primaire : PRIMARY KEY Force la valeur \u00e0 \u00eatre unique et est utilis\u00e9 pour trouver rapidement un enregistrement. Permet l\u2019utilisation par une cl\u00e9 \u00e9trang\u00e8re. Une seule cl\u00e9 primaire permise par table.</p> <p>Cl\u00e9 \u00e9trang\u00e8re : FOREIGN KEY R\u00e9f\u00e9rence un enregistrement d\u2019une autre table. Garanti que l\u2019enregistrement existe.</p> <p>Valeur par d\u00e9faut : DEFAULT Sp\u00e9cifie la valeur utilis\u00e9e lorsqu\u2019un enregistrement est cr\u00e9\u00e9 et qu\u2019aucune valeur n\u2019est sp\u00e9cifi\u00e9e. Si aucune valeur par d\u00e9faut n\u2019est indiqu\u00e9e, NULL est utilis\u00e9e par le syst\u00e8me.</p>"},{"location":"notes_de_cours/section_4.1/#cascade","title":"Cascade","text":"<p>Jusqu\u2019\u00e0 pr\u00e9sent le code suivant provoque une erreur.</p> <pre><code>DELETE FROM enseignants\n    WHERE code_employe = 1;\n</code></pre> <p>Parce que la table Programme contient une cl\u00e9 \u00e9trang\u00e8re vers Enseignant et qu'elle ne pointerait sur rien si l'enseignant est supprim\u00e9.</p> <pre><code>erDiagram  \n    enseignants ||--o{ programmes : \" \" \n    enseignants {\n        NUMERIC(8) code_employe\n        VARCHAR(255) nom\n        VARCHAR(255) prenom\n        NUMERIC(9) num_assurance_sociale\n        TINYINT anciennete\n    }\n    programmes {\n        INTEGER code PK\n        VARCHAR(255) nom\n        NUMERIC(8) responsable FK\n    }</code></pre> <p>La strat\u00e9gie cascade permet de supprimer tous les enregistrements sont r\u00e9f\u00e9renc\u00e9s, donc qui posent probl\u00e8me.</p> <p>Par exemple, ici tous les cours associ\u00e9s aux professeurs seraient \u00e9galement supprim\u00e9s.</p> <pre><code>FOREIGN KEY (colonne) REFERENCES Nom_table(colonne) ON DELETE CASCADE\n</code></pre>"},{"location":"notes_de_cours/section_4.1/#-exercice-411-","title":"--- Exercice 4.1.1 ---","text":"<p>\u00c0 partir du diagramme Ecole.pdf, identifiez les enregistrements de quelles tables seraient supprim\u00e9s si toutes les cl\u00e9s \u00e9trang\u00e8res utilisent la strat\u00e9gie Cascade et que l'on supprime une session.</p>"},{"location":"notes_de_cours/section_4.1/#cascade-suite","title":"Cascade (suite)","text":"<p>La mise \u00e0 jour en cascade permet de modifier la valeur d\u2019une cl\u00e9 primaire et de mettre \u00e0 jour simultan\u00e9ment toutes les cl\u00e9s \u00e9trang\u00e8res (conserver l\u2019int\u00e9grit\u00e9).</p> <p>Utile seulement si la cl\u00e9 primaire n\u2019est pas un identifiant autoincr\u00e9ment\u00e9.</p> <pre><code>FOREIGN KEY (colonne) REFERENCES Nom_table(colonne) ON UPDATE CASCADE\n</code></pre>"},{"location":"notes_de_cours/section_4.1/#cle-unique","title":"Cl\u00e9 unique","text":"<p>Une cl\u00e9 unique est une fa\u00e7on de pr\u00e9ciser qu\u2019une valeur ou un groupe de valeur sont uniques dans la table.</p> <p>La cl\u00e9 primaire est un type particulier de cl\u00e9 unique.</p> <p>ATTENTION : contrairement \u00e0 une cl\u00e9 primaire, une cl\u00e9 unique peut \u00eatre nulle et plusieurs enregistrements peuvent \u00eatre nuls.</p> <p>Pour indiquer qu\u2019une colonne est unique, on place le mot-cl\u00e9 UNIQUE apr\u00e8s le nom de la colonne.</p> <p><pre><code>CREATE TABLE programmes (  \n    code CHAR(6) PRIMARY KEY,\n    nom VARCHAR(255) UNIQUE,\n    responsable NUMERIC(8),\n    ...\n);\n</code></pre> <pre><code>erDiagram  \n    programmes {\n        INTEGER code PK\n        VARCHAR(255) nom\n        NUMERIC(8) responsable FK\n    }</code></pre></p> <p>Pour indiquer une cl\u00e9 unique portant sur plusieurs colonnes, on utilise la syntaxe suivante:</p> <pre><code>CONSTRAINT nom UNIQUE (colonne1, colonne2...)\n</code></pre> <pre><code>CREATE TABLE sessions (\n    id_session INTEGER \n      PRIMARY KEY AUTO_INCREMENT,\n    semestre ENUM('Automne', 'Hiver'),\n    annee YEAR,\n    debut_session DATE,\n    fin_session DATE,    \n    CONSTRAINT semestre_annee_unique \n      UNIQUE (semestre, annee));\n</code></pre> <pre><code>erDiagram  \nsessions {\n        INTEGER session_id PK  \n        ENUM semestre \"not null\"\n        YEAR annee \"not null\"\n        DATE debut_session \"not null\"\n        DATE fin_session \"not null\"   \n    }</code></pre>"},{"location":"notes_de_cours/section_4.1/#nullite","title":"Nullit\u00e9","text":"<p>\u00c0 l\u2019exception des cl\u00e9s primaires, toutes les colonnes peuvent prendre la valeur nulle.</p> <p>On peut emp\u00eacher la pr\u00e9sence de valeur nulle dans une colonne en ajoutant NOT NULL apr\u00e8s le type.</p> <p>Pour \u00e9viter des \u00e9tudiants dont le nom est NULL, on ajoute | not null apr\u00e8s le type sur le diagramme.</p> <pre><code>CREATE TABLE Etudiant (\n    code NUMERIC(7) PRIMARY KEY,\n    nom VARCHAR(255) NOT NULL\n    ...\n);\n</code></pre> <pre><code>erDiagram  \n    etudiants {\n        NUMERIC(8) code PK\n        VARCHAR(255) nom \"not null\"\n        YEAR annee_admission\n        DATETIME date_naissance\n        VARCHAR(10) programme\n     }</code></pre> <p></p>"},{"location":"notes_de_cours/section_4.1/#-exercice-412-","title":"--- Exercice 4.1.2 ---","text":"<p>Modifiez le script de cr\u00e9ation de la base de donn\u00e9es ecole pour inclure les contraintes suivantes :</p> <p>A) Deux programmes ne peuvent pas porter le m\u00eame nom B) Chaque programme doit toujours avoir un professeur responsable C) Un m\u00eame num\u00e9ro de groupe ne peut pas \u00eatre affect\u00e9 au m\u00eame cours \u00e0 la m\u00eame session (il y a un seul groupe 1 de BD1 \u00e0 la session H22) D) Si l'on supprime une \u00c9valuation, on veut supprimer toutes les evaluations_etudiants associ\u00e9es.  </p>"},{"location":"notes_de_cours/section_4.1/#check","title":"Check","text":"<p>La contrainte CHECK permet de v\u00e9rifier que les valeurs suivent une certaine condition. On ins\u00e8re cette contrainte directement dans la d\u00e9finition de la table.</p> <pre><code>CREATE TABLE Nom_table (\n    colonne TYPE,\n    ...\n    CONSTRAINT nom_contrainte CHECK (condition));\n</code></pre> <p>Exemple : les pond\u00e9rations des \u00e9valuations doivent \u00eatre entre 0 et 100.</p> <pre><code>CREATE TABLE evaluations (\n  evaluation_id INTEGER \n    PRIMARY KEY AUTO_INCREMENT\n  ...\n  ponderation NUMERIC(5,2),\n  ...\n  CONSTRAINT note_0_a_100 \n    CHECK (ponderation BETWEEN 0 AND 100));\n</code></pre> <pre><code>erDiagram  \nevaluations {\n        INTEGER evaluation_id PK \n        INTEGER group FK \n        VARCHAR(64) titre\n        NUMERIC(4_1) ponderation\n        DATETIME date_passage \n    }</code></pre>"},{"location":"notes_de_cours/section_4.1/#-exercice-413-","title":"--- Exercice 4.1.3 ---","text":"<p>Ins\u00e9rez une v\u00e9rification pour vous assurer que :</p> <p>A) La note obtenue \u00e0 une \u00e9valuation est positive B) L'anciennet\u00e9 d'un enseignant est entre 0 et 50 C) Les sigles des cours sont dans le format suivant (A est lettre majuscule, # est un entier) : ###-#A#-AA  </p>"},{"location":"notes_de_cours/section_4.1/#que-peut-contenir-un-check","title":"Que peut contenir un CHECK","text":"<p>Certaines colonnes ne peuvent pas faire l\u2019objet d\u2019un CHECK dont:</p> <ul> <li>Colonne avec l\u2019attribut AUTO_INCREMENT  </li> <li>Colonne avec r\u00e9f\u00e9rence d\u2019action (CASCADE).  </li> </ul> <p>On ne peut pas non plus appeler les \u00e9l\u00e9ments suivants dans un CHECK :</p> <ul> <li>Fonction non native ou proc\u00e9dure stock\u00e9e</li> <li>Variable</li> <li>Requ\u00eate</li> <li>Fonction non d\u00e9terministe comme NOW()</li> </ul> <p>Finalement, un CHECK peut contenir les \u00e9l\u00e9ments suivants :</p> <ul> <li>Op\u00e9rateur arithm\u00e9tique</li> <li>Op\u00e9rateur de comparaison</li> <li>Fonction d\u00e9terministe (count, avg, year, \u2026)</li> <li>Comparaison / op\u00e9ration sur plusieurs colonnes d\u2019une m\u00eame table.</li> </ul>"},{"location":"notes_de_cours/section_4.1/#tricher-et-eviter-les-check","title":"Tricher et \u00e9viter les CHECK","text":"<p>\u00c0 l\u2019occasion, on peut vouloir ins\u00e9rer une valeur qui ne respecte pas une condition en raison d\u2019un \u00e9l\u00e9ment sp\u00e9cial.</p> <p>On peut utiliser alors les requ\u00eates sp\u00e9ciales avec la clause IGNORE :</p> <pre><code>INSERT IGNORE INTO ...\nUPDATE IGNORE ...\nLOAD DATA INFILE 'nom' IGNORE INTO TABLE ...\n</code></pre> <p>Comme toute v\u00e9rification, il faut une bonne raison pour l\u2019\u00e9viter !</p>"},{"location":"notes_de_cours/section_4.1/#-exercice-414-","title":"--- Exercice 4.1.4 ---","text":"<p>Impl\u00e9mentez, lorsque possible, les v\u00e9rifications suivantes. Expliquez pourquoi lorsque vous ne pouvez pas les impl\u00e9menter.</p> <p>A) Le nom des documents remis n'exc\u00e8de pas 64 caract\u00e8res (fonction CHAR_LENGTH ?) B) La note d\u2019un \u00e9tudiant n\u2019exc\u00e8de jamais la pond\u00e9ration de l'\u00e9valuation C) La dur\u00e9e d'une session n'exc\u00e8de pas 17 semaines D) Pour une \u00e9valuation, tous les \u00e9tudiants re\u00e7oivent une note E) Tous les documents sont remis \u00e0 la date du jour (si je le d\u00e9pose le 15 mars, alors la valeur dans date_remise est le 15 mars)  </p>"},{"location":"notes_de_cours/section_4.1/#ajouter-ou-retirer-des-contraintes","title":"Ajouter ou retirer des contraintes","text":"<p>On peut modifier les tables pour ajouter ou supprimer des contraintes</p> <pre><code>ALTER TABLE Nom_table\n  ADD CONSTRAINT nom TYPE_CONTRAINTE (contrainte)\n\nALTER TABLE Nom_table\n  DROP [PRIMARY KEY | FOREIGN KEY | CHECK] nom\n</code></pre>"},{"location":"notes_de_cours/section_4.1/#ajouter-une-cle-primaire","title":"Ajouter une cl\u00e9 primaire","text":"<pre><code>ALTER TABLE evaluations\n  ADD CONSTRAINT evaluation_pk PRIMARY KEY (id_evaluation);\n</code></pre>"},{"location":"notes_de_cours/section_4.1/#ajouter-un-check","title":"Ajouter un CHECK","text":"<pre><code>ALTER TABLE evaluations_etudiants\n  ADD CONSTRAINT note_0_a_100 CHECK (note BETWEEN 0 AND 100);\n</code></pre>"},{"location":"notes_de_cours/section_4.1/#supprimer-une-cle-primaire","title":"Supprimer une cl\u00e9 primaire","text":"<pre><code>ALTER TABLE evaluations\n  DROP PRIMARY KEY;\n</code></pre>"},{"location":"notes_de_cours/section_4.1/#supprimer-un-check","title":"Supprimer un CHECK","text":"<pre><code>ALTER TABLE evaluations_etudiants\n  DROP CHECK note_0_a_100;\n</code></pre>"},{"location":"notes_de_cours/section_4.2/","title":"Confidentialit\u00e9 des donn\u00e9es","text":"<p>Cryptage et hashage Cryptage \u00e0 cl\u00e9 sym\u00e9trique Cryptage de la BD</p>"},{"location":"notes_de_cours/section_4.2/#cryptage-et-hashage","title":"Cryptage et hashage","text":"<p>Il est tr\u00e8s souvent n\u00e9cessaire d'assurer la confidentialit\u00e9 des donn\u00e9es. Ainsi, un administrateur de BDD ne peut pas voir les informations de certains champs ou tables.</p> <p>Quelle est la distinction entre le cryptage et le hashage?</p> <p>Cryptage : transformation des donn\u00e9es \u00e0 l\u2019aide d\u2019une donn\u00e9e secr\u00e8te appel\u00e9e cl\u00e9</p> <p>Hashage : transformation non inversible \u00e0 l\u2019aide d\u2019un algorithme</p> <p>Doc : https://dev.mysql.com/doc/refman/8.0/en/encryption-functions.html</p>"},{"location":"notes_de_cours/section_4.2/#hashage","title":"Hashage","text":"<p>Une fonction de hashage accepte g\u00e9n\u00e9ralement une seule cha\u00eene en entr\u00e9e et retourne une valeur correspondant \u00e0 l\u2019entr\u00e9e (appel\u00e9 hash).</p> <p>La fonction peut produire un hash unique pour chaque entr\u00e9e (fonction injective) ou permettre \u00e0 plusieurs entr\u00e9es de partager le m\u00eame hash. Le deuxi\u00e8me cas est celui le plus rencontr\u00e9.</p> <p>Il faut \u00e9videmment \u00e9valuer le risque de collision de hash (partage de valeur). Pour le hash de Git, ce risque est estim\u00e9 \u00e0 environ $1 times 10^{-48}$, soit de tirer au hasard un atome sur la Terre. </p> <p>Les fonctions utilisables par MySQL (et d'autres langages) sont</p> Fonction Longueur du hash Type de colonne MD5 128 bits CHAR(32) SHA 160 bits CHAR(40) SHA2 variable CHAR(56) \u00e0 CHAR(128) <p>Elles retournent toutes un hash en hexad\u00e9cimal. On peut le convertir en binaire en utilisant la fonction UNHEX().</p>"},{"location":"notes_de_cours/section_4.2/#sha2","title":"SHA2","text":"<p>La fonction SHA2 permet d\u2019utiliser divers algorithmes. Les algorithmes sont SHA-224, SHA-256, SHA-384 et SHA-512.</p> <p>L\u2019algorithme retourne un nombre de bits \u00e9gal au nombre apr\u00e8s le SHA (par exemple SHA-256 retourne un nombre binaire de 256 bits).</p> <p>Le standard est d\u2019utiliser au moins 256 bits. On voit souvent 256 et 512 \u00eatre utilis\u00e9s.</p> <p>Exemple</p> <p>L\u2019utilisateur veut enregistrer un mot de passe 'tarte123'. Pour le hasher avec SHA-256 avant de l\u2019int\u00e9grer \u00e0 la BD on utilise :</p> <pre><code>INSERT INTO Utilisateur (nom, mot_de_passe)\n    VALUES ('Patissier21', SHA2('tarte123', 256));\n</code></pre> <p>R\u00e9sultat de SHA2</p> <p>La requ\u00eate  <pre><code>SELECT * FROM Utilisateur;\n</code></pre></p> <p>retourne:</p> <pre><code>| nom           | mot_de_passe                                                     |\n\n| patissier21   | b2c4b81704855df00cff57312d46ec28254e2f69f526cc61da5f2df20c43d075 |\n| jardiner14    | b48cea174391677879618ace9ea78531f5a0d18551de187ee76eb3190624ef35 |\n...\n</code></pre>"},{"location":"notes_de_cours/section_4.2/#avantages-et-desavantages-du-hashage","title":"Avantages et d\u00e9savantages du hashage","text":"<p>Avantages :</p> <ul> <li>Plus rapide qu\u2019un cryptage</li> <li>Espace m\u00e9moire constant</li> <li>Impossible \u00e0 inverser</li> </ul> <p>D\u00e9savantage :</p> <ul> <li>Impossible d\u2019avoir acc\u00e8s \u00e0 la donn\u00e9e originale</li> </ul>"},{"location":"notes_de_cours/section_4.2/#quand-utiliser-le-hashage","title":"Quand utiliser le hashage?","text":"<ul> <li>Pour les donn\u00e9es que nous n\u2019avons pas besoin de consulter</li> <li>V\u00e9rification d\u2019int\u00e9grit\u00e9 de fichier ou de transport (checksum) </li> </ul>"},{"location":"notes_de_cours/section_4.2/#fonction-de-sha256","title":"Fonction de SHA256","text":"<p>https://qvault.io/cryptography/how-sha-2-works-step-by-step-sha-256/#:~:text=SHA%2D2%20is%20an%20algorithm,is%20the%20output%20size%2C%20256.</p> <ol> <li>Convertir en binaire</li> <li>Ajouter un 1</li> <li>Allonger avec des 0 \u00e0 la fin pour obtenir un multiple de 512 moins 64 bits</li> <li>Ajouter la longueur de l'entr\u00e9e originale en binaire sur 64 bits.</li> </ol> <p>Exemple</p> <ol> <li>Allo -&gt; 01100001 01101100 01101100 01101111</li> <li>01100001 01101100 01101100 01101111 1</li> <li>01100001 01101100 01101100 01101111 1000000 00000000 00000000     00000000 00000000 00000000 00000000 00000000 00000000 00000000     00000000 00000000 00000000 00000000 00000000 00000000 00000000     00000000 00000000 00000000 00000000 00000000 00000000 00000000     00000000 00000000 00000000 00000000 00000000 00000000 00000000     00000000 00000000 00000000 00000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000     00000000 00000000 00000000 00000000 00000000 00000000 00000000</li> <li>01100001 01101100 01101100 01101111 1000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000    00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000100</li> <li>Initialisation des 8 constantes de hash qui sont la repr\u00e9sentation binaire des 32 premiers bits de la partie fractionnaire des racines des 8 premiers nombres premiers (2, 3, 5, 7, 11, 13, 17, 19)</li> </ol> <p>Exemple</p> <p>Racine de 2 = 1.41421356237 Partie fractionnaire = 41421356237 En binaire = 1101010000010011110011001100111</p> <ol> <li>Initialisation des 64 constantes d'arrondissement qui sont la repr\u00e9sentation binaire des 32 premiers bits de la partie fractionnaire des racines cubiques des 64 premiers nombres premiers (2, 3, 5, 7, 11, 13, 17, 19 - 311)</li> <li>Cr\u00e9ation de chunk (segment) de 512 bits de long</li> <li>Cr\u00e9ation du message pour chaque chunk </li> <li>Compression du message en utilisant les constantes \u00e9tablies et concat\u00e9nation du r\u00e9sultat.</li> </ol>"},{"location":"notes_de_cours/section_4.2/#cryptage","title":"Cryptage","text":"<p>Une fonction de cryptage transforme une cha\u00eene avec les donn\u00e9es d\u2019une cha\u00eene secr\u00e8te appel\u00e9e \u00ab cl\u00e9 \u00bb.</p> <p>Texte clair + cl\u00e9 \ud83e\udc7a texte crypt\u00e9 Texte crypt\u00e9 + cl\u00e9 \ud83e\udc7a texte clair </p> <p>On appelle cryptage \u00e0 cl\u00e9 sym\u00e9trique lorsque la cl\u00e9 servant \u00e0 crypter et \u00e0 d\u00e9crypter est la m\u00eame.</p> <p>Voir Illustration - Hashage et cryptage </p>"},{"location":"notes_de_cours/section_4.2/#securite-du-cryptage-symetrique","title":"S\u00e9curit\u00e9 du cryptage sym\u00e9trique","text":"<p>La s\u00e9curit\u00e9 d\u2019un cryptage \u00e0 cl\u00e9 sym\u00e9trique repose sur 2 facteurs :</p> <ul> <li>Le secret de la cl\u00e9</li> <li>La longueur de la cl\u00e9</li> </ul>"},{"location":"notes_de_cours/section_4.2/#algorithme-aes","title":"Algorithme AES","text":"<p>Le Advance Encryption Standard (AES) est la m\u00e9thode de cryptage sym\u00e9trique la plus utilis\u00e9e aujourd\u2019hui.</p> <p>Les donn\u00e9es sont crypt\u00e9es par bloc de 128 bits. La cl\u00e9 peut faire 128, 192 ou 256 bits.</p> <p>Il effectue plusieurs \u00e9tapes de permutation / substitution</p>"},{"location":"notes_de_cours/section_4.2/#crypter-avec-mysql","title":"Crypter avec MySQL","text":"<p>Pour crypter, on utilise la fonction AES_ENCRYPT. Son premier argument est le texte \u00e0 crypter et le second la cl\u00e9 secr\u00e8te. La cl\u00e9 doit avoir entre 128 et 256 bits.</p> <pre><code>INSERT INTO Utilisateur (nom, carte_credit)\n  VALUES ('Patissier21', AES_ENCRYPT('1234123412341234',  \n  UNHEX('F3229A0B371ED2D9441B830D21A390C3')));\n</code></pre> <p>On place le r\u00e9sultat dans un BLOB.</p>"},{"location":"notes_de_cours/section_4.2/#fonction-unhex","title":"Fonction UNHEX","text":"<p>La fonction UNHEX convertit une cha\u00eene de valeurs hexad\u00e9cimale en sa repr\u00e9sentation sous forme de cha\u00eene de caract\u00e8res.</p> Mot HEX(mot) CAST(UNHEX(hex) AS CHAR) A 41 A Allo 416C6C6F Allo"},{"location":"notes_de_cours/section_4.2/#decrypter-avec-mysql","title":"D\u00e9crypter avec MySQL","text":"<p>Pour d\u00e9crypter, on utilise la fonction AES_DECRYPT. Le premier argument est la valeur \u00e0 d\u00e9crypter, le second la cl\u00e9 secr\u00e8te.</p> <pre><code>SELECT nom, CAST(AES_DECRYPT(carte_credit,   \n  UNHEX('F3229A0B371ED2D9441B830D21A390C3\u2019)) AS CHAR)\n  AS carte_credit FROM Utilisateur;\n</code></pre> <p>Le r\u00e9sultat du d\u00e9cryptage.</p> <pre><code>| nom           | carte_credit     |\n\n| patissier21   | 1234123412341234 |\n| jardiner14    | 9876987698769876 |\n</code></pre> <p>Si la mauvaise cl\u00e9 est pass\u00e9e, alors la valeur NULL est retoun\u00e9e (et non le r\u00e9sultat du d\u00e9cryptage avec la mauvaise cl\u00e9 !)</p>"},{"location":"notes_de_cours/section_4.2/#phrase-secrete","title":"Phrase secr\u00e8te","text":"<p>Plut\u00f4t que d\u2019utiliser une cl\u00e9 binaire, on peut utiliser une phrase secr\u00e8te comme mot de passe. La cl\u00e9 est cependant limit\u00e9e \u00e0 256 caract\u00e8res. Comment fait-on ?</p> <ul> <li>On peut hasher la phrase secr\u00e8te pour obtenir une cha\u00eene de la bonne longueur !</li> </ul>"},{"location":"notes_de_cours/section_4.2/#phrase-secrete_1","title":"Phrase secr\u00e8te","text":"<pre><code># Insertion\nINSERT INTO Utilisateur (nom, carte_credit) \n  VALUES ('Patissier21', AES_ENCRYPT('1234123412341234',\n                           UNHEX(SHA2('secret', 256))));\n\n# Lecture\nSELECT nom, \n  CAST(AES_DECRYPT(carte_credit, UNHEX(SHA2('secret', 256))) AS CHAR) AS 'Carte credit'\n  FROM Utilisateur;\n</code></pre>"},{"location":"notes_de_cours/section_4.2/#cryptage-de-la-bd","title":"Cryptage de la BD","text":"<p>L\u2019engin de stockage de donn\u00e9es InnoDB permet de crypter l\u2019ensemble d\u2019une table ou de la BD. Via un plug-in.</p> <p>Ces manipulations ne sont pas vues en classe.</p> <p>https://dev.mysql.com/doc/refman/8.0/en/innodb-data-encryption.html</p>"},{"location":"notes_de_cours/section_4.2/#-exercice-421-","title":"--- Exercice 4.2.1 ---","text":"<p>On cr\u00e9e la table de renseignements personnels suivant :</p> <ol> <li>Nom</li> <li>Mot de passe</li> <li>Le contenu du certificat de naissance</li> <li>Une cha\u00eene authentifiant le contenu du certificat de naissance</li> <li>Num\u00e9ro de compte en banque</li> <li>Date de naissance</li> </ol> <p>Ajoutez les informations d\u2019une personne fictive en cryptant ou hashant les donn\u00e9es selon la situation.</p> <p>Affichez ensuite ces informations</p>"},{"location":"notes_de_cours/section_4.3/","title":"Gestion des acc\u00e8s","text":"<p>CRUD des utilisateurs Conf\u00e9rer et r\u00e9voquer des privil\u00e8ges Cr\u00e9er des r\u00f4les  </p>"},{"location":"notes_de_cours/section_4.3/#pourquoi-gerer-les-roles","title":"Pourquoi g\u00e9rer les r\u00f4les","text":"<p>On d\u00e9veloppe un site web avec les contraintes de s\u00e9curit\u00e9 suivantes.</p> <ul> <li>Les programmeurs peuvent modifier des tables, des d\u00e9clencheurs et des enregistrements. </li> <li>L\u2019administrateur de la BD peut ajouter des utilisateurs et accomplir toutes les op\u00e9rations des d\u00e9veloppeurs</li> <li>Les visiteurs peuvent uniquement ajouter, lire, modifier, ou supprimer des enregistrements.</li> </ul> <p>De cette fa\u00e7on, si un mot de passe utilis\u00e9 dans le site web est vol\u00e9, l\u2019acc\u00e8s \u00e0 la BD est limit\u00e9. </p>"},{"location":"notes_de_cours/section_4.3/#crud-des-utilisateurs","title":"CRUD des utilisateurs","text":"<p>Pour ajouter un nouvel utilisateur, on utilise la syntaxe suivante:</p> <pre><code>CREATE USER nom IDENTIFIED BY mot_de_passe;\n</code></pre> <p>Exemple: <pre><code>CREATE USER visiteur IDENTIFIED BY '12345\u2019;\n</code></pre></p> <p>Il existe toujours un utilisateur de base : root@localhost</p>"},{"location":"notes_de_cours/section_4.3/#modifier-un-utilisateur","title":"Modifier un utilisateur","text":"<p>Pour changer un mot de passe, la requ\u00eate est:</p> <pre><code>ALTER USER nom IDENTIFIED BY nouveau_mot_de_passe;\n</code></pre> <p>Exemple: <pre><code>ALTER USER visiteur IDENTIFIED BY '54321';\n</code></pre></p> <p>Pour renommer un utilisateur, la requ\u00eate est :</p> <pre><code>RENAME USER ancien_nom TO nouveau_nom;\n</code></pre> <p>Exemple : <pre><code>RENAME USER visiteur TO visiteurs;\n</code></pre></p>"},{"location":"notes_de_cours/section_4.3/#supprimer-un-utilisateur","title":"Supprimer un utilisateur","text":"<p>Pour retirer un utilisateur, on utilise la requ\u00eate:</p> <pre><code>DROP USER nom;\n</code></pre> <p>Exemple :</p> <pre><code>DROP USER visiteurs;\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#niveaux-de-privilege","title":"Niveaux de privil\u00e8ge","text":"<p>Les niveaux de privil\u00e8ges accordent certains droits d\u2019acc\u00e8s pour modifier des parties de la BD. Les niveaux (non exhaustif) sont</p> ALL (tout) DELETE REFERENCES (cr\u00e9e des cl\u00e9s \u00e9trang\u00e8res) ALTER DROP SELECT CREATE DROP ROLE SHOW DATABASES CREATE ROLE EXECUTE (routines) TRIGGER CREATE ROUTINE FILE UPDATE CREATE USER INSERT USAGE"},{"location":"notes_de_cours/section_4.3/#conferer-un-privilege","title":"Conf\u00e9rer un privil\u00e8ge","text":"<p>Pour assigner un privil\u00e8ge \u00e0 un r\u00f4le, on utilise une requ\u00eate GRANT.</p> <pre><code>GRANT priviliege1, privilege2 ON [* | table] TO nom_utilisateur;\n</code></pre> <p>On ajoute le privil\u00e8ge de lecture sur toutes les tables de la base de donn\u00e9es ecole aux visiteurs.</p> <pre><code>USE Ecole;\nGRANT SELECT ON * TO 'visiteurs\u2019;\n</code></pre> <p>Pour ajouter le privil\u00e8ge d\u2019\u00e9criture et de modification sur la table Etudiant</p> <pre><code>GRANT INSERT, UPDATE ON etudiants TO 'visiteurs';\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#revoquer-un-privilege","title":"R\u00e9voquer un privil\u00e8ge","text":"<p>La requ\u00eate de retrait de privil\u00e8ge est REVOKE.</p> <pre><code>REVOKE priviliege1, privilege2 ON [* | table] \n  FROM nom_utilisateur;\n</code></pre> <p>Par exemple, on r\u00e9voque le privil\u00e8ge d\u2019ajout des visiteurs sur la table Etudiant.</p> <pre><code>REVOKE UPDATE ON etudiants FROM \u2018visiteurs\u2019;\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#determiner-lutilisateur-connecte","title":"D\u00e9terminer l'utilisateur connect\u00e9","text":"<p>La fonction USER() retourne l\u2019utilisateur actuellement connect\u00e9 \u00e0 la base de donn\u00e9es.</p> <p>Exemple: <pre><code>SELECT USER();\n</code></pre></p> <pre><code>| USER()         |\n|-|\n| root@localhost |\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#-exercice-431-","title":"--- Exercice 4.3.1 ---","text":"<p>Cr\u00e9ez un nouvel utilisateur qui poss\u00e8de tous les privil\u00e8ges.</p> <p>D\u00e9connectez-vous en fermant Workbench et reconnectez-vous avec le nouvel utilisateur.</p>"},{"location":"notes_de_cours/section_4.3/#les-roles","title":"Les r\u00f4les","text":"<p>Que faire si on a 8 programmeurs qui ont chacun leur acc\u00e8s distinct (nom et mot de passe), mais qui doivent tous avoir le m\u00eame niveau de privil\u00e8ge.</p> <p>Imaginez qu\u2019on ajoute une table. Doit-on modifier les acc\u00e8s de tous les utilisateurs ?</p> <p>\u00c7a serait plus simple d\u2019avoir une structure contenant les privil\u00e8ges.</p> <p>Un r\u00f4le est une liste d\u2019acc\u00e8s. Plut\u00f4t que de d\u00e9finir les acc\u00e8s par utilisateur, on peut leur assigner un r\u00f4le. </p> <p>Donc tous les utilisateurs avec les m\u00eames privil\u00e8ges d\u2019acc\u00e8s auront le m\u00eame r\u00f4le. Cela facilite grandement le changement de privil\u00e8ges.</p>"},{"location":"notes_de_cours/section_4.3/#definir-un-role","title":"D\u00e9finir un r\u00f4le","text":"<p>On utilise CREATE ROLE pour cr\u00e9er un nouveau r\u00f4le et DROP ROLE pour le supprimer.</p> <p>Il n'y a pas de requ\u00eate pour changer le nom d'un r\u00f4le.</p> <pre><code>CREATE ROLE nom_role;\nDROP ROLE nom_role;\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#conferer-ou-revoquer-un-privilege-a-un-role","title":"Conf\u00e9rer ou r\u00e9voquer un privil\u00e8ge \u00e0 un r\u00f4le","text":"<p>On remplace le nom d\u2019utilisateur dans la requ\u00eate GRANT ou REVOKE par le nom du r\u00f4le.</p> <pre><code>GRANT privilege ON [*| Nom table] TO nom_role;\nREVOKE privilege ON [* | Nom table] FROM nom_role;\n</code></pre> <p>Par exemple, on permet au programmeur de cr\u00e9er des tables et des cl\u00e9s \u00e9trang\u00e8res.</p> <pre><code>GRANT CREATE TABLE, REFERENCES ON * TO programmeur;\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#assigner-un-role-a-un-utilisateur","title":"Assigner un r\u00f4le \u00e0 un utilisateur","text":"<p>On peut affecter un r\u00f4le directement \u00e0 la cr\u00e9ation</p> <pre><code>CREATE USER nom IDENTIFIED BY mot de passe\n  DEFAULT ROLE role1, role2...;\n</code></pre> <p>Exemple:</p> <pre><code>CREATE USER alice IDENTIFIED BY 'chat'\n  DEFAULT ROLE programmeur ;\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#modifier-le-role-affecte-un-utilisateur","title":"Modifier le r\u00f4le affect\u00e9 un utilisateur","text":"<p>On peut modifier les r\u00f4les avec</p> <pre><code>GRANT role1, role2 ... TO utilisateur1, utilisateur2...\n\nREVOKE role FROM utilisateur;\n</code></pre>"},{"location":"notes_de_cours/section_4.3/#autres-fonctions-utiles-pour-la-gestion-des-roles","title":"Autres fonctions utiles pour la gestion des r\u00f4les","text":"<p>Afficher l'utilisateur connect\u00e9 <pre><code>USER() \n</code></pre></p> <p>Afficher tous les r\u00f4les de l\u2019utilisateur connect\u00e9 <pre><code>CURRENT_ROLE()\n</code></pre></p> <p>Afficher les privil\u00e8ges <pre><code>SHOW GRANTS FOR role | utilisateur\n</code></pre></p>"},{"location":"notes_de_cours/section_4.3/#-exercice-432-","title":"--- Exercice 4.3.2 ---","text":"<p>Cr\u00e9er un r\u00f4le enseignant qui peut modifier les tables \u00c9valuation et \u00c9valuation_etudiant ainsi qu\u2019un r\u00f4le responsable qui peut changer la table Cours, Inscription, Groupe, Session et Etudiant.</p> <p>Ajouter un utilisateur appel\u00e9 Scott Summers qui est enseignant et Jean Grey qui est enseignante et responsable.</p>"},{"location":"notes_de_cours/section_5.1/","title":"Variables, conditions et boucles","text":"<p>On retrouve 2 types de variables en MySQL :</p> <ul> <li>Variables globales </li> <li>Variables locales</li> </ul> <p>Les variables globales sont accessibles partout, mais elles doivent \u00eatre red\u00e9clar\u00e9es \u00e0 chaque ex\u00e9cution.</p> <p>Lorsqu'on peut utiliser une variable locale, on le fait!</p>"},{"location":"notes_de_cours/section_5.1/#variables-globales","title":"Variables globales","text":"<p>Pour d\u00e9clarer ou modifier une variable globale on utilise l\u2019instruction:</p> <pre><code>SET @variable = valeur\n</code></pre> <p>Les valeurs possibles dans une variables sont :</p> <p>Integer, decimal, float, blob, text</p> <p>Tout autre type est converti dans l'un de ces types.</p>"},{"location":"notes_de_cours/section_5.1/#afficher-une-variable","title":"Afficher une variable","text":"<p>On utilise l\u2019instruction SELECT pour afficher une variable.</p> <pre><code>SET @nombre = 12;\nSELECT @nombre;\n</code></pre> <p>Le r\u00e9sultat est : <pre><code>| @nombre |\n--\n| 12      |\n</code></pre></p>"},{"location":"notes_de_cours/section_5.1/#variables-locales","title":"Variables locales","text":"<p>Elles doivent \u00eatre utilis\u00e9es dans un bloc BEGIN ... END</p> <pre><code>DECLARE nom TYPE DEFAULT valeur;\n</code></pre> <p>Par exemple <pre><code>DECLARE _nombre INTEGER DEFAULT 12;\n</code></pre></p> <p>Le DEFAULT valeur peut \u00eatre omis pour ne pas affecter de valeurs lors de la d\u00e9claration. On les modifie \u00e9galement en utilisant l\u2019instruction SET ou un SELECT.</p>"},{"location":"notes_de_cours/section_5.1/#variables-locales_1","title":"Variables locales","text":"<p>Toutes les instructions DECLARE doivent \u00eatre au d\u00e9but du bloc BEGIN.</p> <p>Pour reconna\u00eetre les variables locales des colonnes, toutes les variables locales doivent \u00eatre pr\u00e9fix\u00e9es de  (standard de code)</p>"},{"location":"notes_de_cours/section_5.1/#operations","title":"Op\u00e9rations","text":"<p>Les op\u00e9rations arithm\u00e9tiques et de comparaison sont permises dans les membres de droite des assignations.</p> <p>On peut \u00e9galement utiliser les variables dans les requ\u00eates.</p> <pre><code>SELECT nom FROM etudiants \n  WHERE code = @code;\n</code></pre>"},{"location":"notes_de_cours/section_5.1/#conditions-et-boucles","title":"Conditions et boucles","text":"<p>L\u2019instruction conditionnelle de base \u00e0 la syntaxe suivante</p> <pre><code>IF condition THEN\n    traitements\u2026\nEND IF;\n</code></pre> <p>Pas d\u2019accolade { }, elles sont remplac\u00e9es par THEN \u2026 END IF;</p> <p>Par exemple, on v\u00e9rifie que l'\u00e2ge est plus grande ou \u00e9gale \u00e0 18 (le code ne fonctionne pas, on ne peut pas mettre d'instructions conditionnelles hors d'une fonction en SQL).</p> <pre><code>IF @age &gt;= 18 THEN\n  SELECT 'Vous etes majeur';\nEND IF;\n</code></pre>"},{"location":"notes_de_cours/section_5.1/#traitements-alternatifs","title":"Traitements alternatifs","text":"<pre><code>IF condition THEN\n    traitement\nELSEIF condition alternative THEN\n    traitement\nELSE\n    traitement\nEND IF;\n</code></pre>"},{"location":"notes_de_cours/section_5.1/#instruction-par-cas","title":"Instruction par cas","text":"<p>Semblable \u00e0 l\u2019instruction switch</p> <pre><code>CASE \n  WHEN condition THEN traitement\n  WHEN condition THEN traitement\n  ELSE traitement\nEND\n</code></pre> <p>La premi\u00e8re condition valid\u00e9e est ex\u00e9cut\u00e9e, puis le CASE est conclut (pas de break et pas de possibilit\u00e9 d'effectuer plusieurs traitements).</p>"},{"location":"notes_de_cours/section_5.1/#exemple-de-case","title":"Exemple de CASE","text":"<p>L'exemple est un peu avanc\u00e9, retenez l'\u00e9l\u00e9ment suivant : on peut utiliser le CASE directement dans un SELECT</p> <pre><code>SELECT      \n  CASE \n    WHEN nb_echecs = 0 THEN \"Pas d'echec\"\n    WHEN nb_echecs &lt;= 2 THEN '2 echecs ou moins'\n    ELSE 'Plus de deux echecs' \n  END\n  FROM ...          \n</code></pre>"},{"location":"notes_de_cours/section_5.1/#instructions-repetees","title":"Instructions r\u00e9p\u00e9t\u00e9es","text":"<p>Boucle while qui ex\u00e9cute un traitement tant que la condition est v\u00e9rifi\u00e9e.</p> <pre><code>WHILE condition DO\n    traitements\u2026\nEND WHILE;\n</code></pre> <p>Boucle qui effectue au moins une fois le traitement (semblable \u00e0 la boucle do-while).</p> <pre><code>REPEAT \n    traitements\u2026\nUNTIL condition\nEND REPEAT;\n</code></pre>"},{"location":"notes_de_cours/section_5.2/","title":"Fonctions et d\u00e9clancheurs","text":""},{"location":"notes_de_cours/section_5.2/#fonctions","title":"Fonctions","text":"<p>Qu'est-ce qu'une fonction ?</p> <ul> <li>Traitement regroup\u00e9 dans une structure. Peut accepter des valeurs et les transformer pour retourner un r\u00e9sultat.</li> </ul> <p>Particularit\u00e9 en SQL :</p> <ul> <li>Le type de retour VOID n'existe pas. Toutes les fonctions retournent un r\u00e9sultat.</li> </ul>"},{"location":"notes_de_cours/section_5.2/#types-de-fonction","title":"Types de fonction","text":"<p>Plusieurs types de caract\u00e9ristiques de fonctions existent dans MySQL. On en distingue principalement 2 :</p> <ul> <li>Caract\u00e8re d\u00e9terministe</li> <li>Contenu de la fonction (Type de requ\u00eate qu'elle contient)</li> </ul>"},{"location":"notes_de_cours/section_5.2/#caractere-deterministe","title":"Caract\u00e8re d\u00e9terministe","text":"<p>Indique si la valeur de retour est d\u00e9termin\u00e9e seulement selon les param\u00e8tres ou non.</p> <p>2 valeurs possibles :</p> <ul> <li>DETERMINISTIC</li> <li>NOT DETERMINISTIC (NOW, RAND...)</li> </ul>"},{"location":"notes_de_cours/section_5.2/#contenu","title":"Contenu","text":"<p>4 valeurs repr\u00e9sentent le contenu d\u2019une fonction :</p> <p>NO SQL : ne contient pas d\u2019instruction SQL CONTAINS SQL : contient des instructions SQL READS SQL DATA : contient une op\u00e9ration SELECT MODIFIES SQL DATA : contient une op\u00e9ration INSERT, UPDATE ou DELETE</p> <p>On indique toujours une seule caract\u00e9ristique de contenu. (MODIFIES implique READS). </p>"},{"location":"notes_de_cours/section_5.2/#exigence-minimale","title":"Exigence minimale","text":"<p>Dans vos fonctions, vous devez pr\u00e9ciser explicitement au moins une caract\u00e9ristique de d\u00e9terministe ou de contenu.</p> <p>Pour le cours, il faut pr\u00e9ciser les deux caract\u00e9ristiques en tout temps</p> <p>Par d\u00e9faut : D\u00e9terminisme : NOT DETERMINISTIC Valeur : CONTAINS SQL</p> <p>Vous pouvez en pr\u00e9ciser une de chaque type.</p>"},{"location":"notes_de_cours/section_5.2/#cas-des-fonctions-non-deterministe","title":"Cas des fonctions non d\u00e9terministe","text":"<p>ERREUR 1418 : This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you might want to use the less safe log_bin_trust_function_creators variable).</p> <p>Pour \u00e9viter cette erreur, on peut ex\u00e9cuter la ligne suivante AVANT de cr\u00e9er la fonction :</p> <pre><code>SET GLOBAL log_bin_trust_function_creators = 1;\n</code></pre> <p>R\u00e9f\u00e9rence : https://stackoverflow.com/questions/26015160/deterministic-no-sql-or-reads-sql-data-in-its-declaration-and-binary-logging-i</p>"},{"location":"notes_de_cours/section_5.2/#declarer-une-fonction","title":"D\u00e9clarer une fonction","text":"<pre><code>DELIMITER $$\n\nCREATE FUNCTION nom_fonction() RETURNS TYPE CARACTERISTIQUE_1 CARACTERISTIQUE_2\nBEGIN   \n  ...\n  RETURN VALEUR;\nEND $$\n\nDELIMITER ;\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#exemple-de-fonction","title":"Exemple de fonction","text":"<p>Fonction qui retourne le nombre d\u2019enregistrements de la table \u00c9tudiant.</p> <pre><code>DELIMITER $$\n\nCREATE FUNCTION nombre_etudiants() RETURNS INTEGER NOT DETERMINISTIC READS SQL DATA\nBEGIN       \n  DECLARE _nombre INT;    \n  SET _nombre = (SELECT count(*) FROM etudiants);   \n  RETURN _nombre;\nEND $$\n\nDELIMITER ;\n</code></pre> <p>Pour ex\u00e9cuter la fonction</p> <pre><code>SELECT nombre_etudiants();\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#ajouter-des-parametres","title":"Ajouter des param\u00e8tres","text":"<p>On pr\u00e9cise les param\u00e8tres entre les parenth\u00e8ses en utilisant la syntaxe  <pre><code>nom_parametre TYPE\n</code></pre></p>"},{"location":"notes_de_cours/section_5.2/#exemple-de-fonction_1","title":"Exemple de fonction","text":"<p>La fonction ajoute 1 \u00e0 son argument.</p> <pre><code>DELIMITER $$\n\nCREATE FUNCTION plus_un(_nombre INTEGER) RETURNS INTEGER DETERMINISTIC CONTAINS SQL\nBEGIN       \n  RETURN _nombre + 1;\nEND $$\n\nDELIMITER ;\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#supprimer-une-fonction","title":"Supprimer une fonction","text":"<p>L\u2019instruction pour retirer une fonction est :</p> <pre><code>DROP FUNCTION nom_fonction;\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#documenter-une-fonction","title":"Documenter une fonction","text":"<p>Pour documenter une fonction, on utilise un commentaire de style JavaDOC</p> <pre><code>/**\n * Description de la fonction\n *\n * @param _nom_parametre Description\n * @param _nom_parametre Description\n * @return Description de la valeur retourn\u00e9e\n */\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#-exercice-521-","title":"--- Exercice 5.2.1 ---","text":"<p>A. Faites une fonction qui retourne la somme de deux entiers.</p> <p>B. Faites une fonction qui calcule la factorielle d\u2019un entier.</p> <p>Rappel :</p> <p>6! = 6 x 5 x 4 x 3 x 2 x 1 x 1   0! = 1</p> <p>C. Retournez le nombre d\u2019\u00e9tudiants inscrit dans un groupe dont vous connaissez la session (semestre et annee), le cours (sigle) et le num\u00e9ro du groupe.</p> <p>Effectuez cet exerice de deux fa\u00e7ons : sans utiliser de jointure et en utilisant des jointures.</p> <p>Param\u00e8tres : semestre, annee, sigle, numero_groupe </p> <p>Exemples d'ex\u00e9cution:</p> Semestre Annee Sigle Num\u00e9ro de groupe Nombre d'\u00e9tudiants Automne 2020 420-1D6-VI 1 3 Automne 2021 420-1D6-VI 1 2"},{"location":"notes_de_cours/section_5.2/#declencheurs","title":"D\u00e9clencheurs","text":"<p>Comment r\u00e9soudre les situations suivantes :</p> <ul> <li>Si l\u2019on essaie d\u2019ajouter une note plus grande que la note maximale d\u2019\u00e9valuation, alors on affecte la note maximale</li> <li>Apr\u00e8s la cr\u00e9ation d'une Evaluation, on cr\u00e9e un ligne de EvaluationEtudiant pour chaque \u00e9tudiant du groupe</li> <li>Si l'on supprime une EvaluationEtudiant, alors on supprime le document associ\u00e9 (sens inverse du ON CASCADE) </li> </ul> <p>Un d\u00e9clencheur (appel\u00e9 commun\u00e9ment Trigger) permet d\u2019effectuer un traitement imm\u00e9diatement avant ou apr\u00e8s l'une de ces op\u00e9rations :</p> <ul> <li>INSERT </li> <li>UPDATE</li> <li>DELETE</li> </ul>"},{"location":"notes_de_cours/section_5.2/#syntaxe-des-declencheurs","title":"Syntaxe des d\u00e9clencheurs","text":"<pre><code>DELIMITER $$\nCREATE TRIGGER nom TEMPS EVENEMENT ON Table FOR EACH ROW\nBEGIN\n    traitement\nEND; $$\nDELIMITER ;\n\nTEMPS : BEFORE ou AFTER\nEVENEMENT : INSERT, UPDATE ou DELETE\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#choisir-before-ou-after","title":"Choisir BEFORE ou AFTER","text":"<p>BEFORE : Quand il faut changer une valeur \u00e0 ins\u00e9rer ou \u00e0 modifier.</p> <p>AFTER : Quand on veut s\u2019assurer que la donn\u00e9e soit bien ins\u00e9r\u00e9e avant de faire le traitement (ex. n\u2019a pas d\u00e9clench\u00e9 un check erron\u00e9). </p>"},{"location":"notes_de_cours/section_5.2/#acceder-a-lenregistrement-modifie","title":"Acc\u00e9der \u00e0 l'enregistrement modifi\u00e9","text":"<p>On peut utiliser les r\u00e9f\u00e9rences OLD et NEW pour acc\u00e9der \u00e0 l'enregistrement qui fait l'objet d'un d\u00e9clencheur.</p> Type de requ\u00eate OLD NEW INSERT NULL L'enregistrement ins\u00e9r\u00e9 UPDATE L'enregistrement avant la modification L'enregistrement apr\u00e8s la modification DELETE L'enregistrement supprim\u00e9 NULL"},{"location":"notes_de_cours/section_5.2/#exemple","title":"Exemple","text":"<p>Si l\u2019on essaie d\u2019ajouter une note plus grande que la note maximale d\u2019\u00e9valuation, alors on affecte la note maximale</p> <pre><code>DELIMITER $$\nCREATE TRIGGER respect_note_maximale BEFORE INSERT ON Evaluation_etudiant FOR EACH ROW\nBEGIN\n  DECLARE _note_maximale INTEGER;\n  SET _note_maximale = (\n    SELECT ponderation FROM evaluations \n      WHERE id_evaluation = NEW.id_evaluation\n  );\n\n  IF NEW.note &gt; _note_maximale THEN\n    SET NEW.note = _note_maximale;\n  END IF;\nEND $$\n\nDELIMITER ;\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#documenter-un-declencheur","title":"Documenter un d\u00e9clencheur","text":"<p>Pour documenter un d\u00e9clencheur, on utilise un commentaire de style JavaDOC</p> <pre><code>/**\n * Description du TRIGGER\n *\n * @dependencies Table_dependante, table_dependante...\n */\n</code></pre>"},{"location":"notes_de_cours/section_5.2/#demonstration","title":"D\u00e9monstration","text":"<p>Si la date de passation d'une nouvelle \u00e9valuation est hors de la dur\u00e9e de la session, alors on lui affecte la valeur nulle.</p>"},{"location":"notes_de_cours/section_5.2/#-exercice-522-","title":"--- Exercice 5.2.2 ---","text":"<p>Ajoutez les d\u00e9clencheurs permettant d'effectuer les traitements suivants</p> <p>A. Lorsqu'on supprime un enseignant, tous les programmes dont il est responsable sont modifi\u00e9s pour que le responsable soit NULL (enlever la contrainte NOT NULL sur la colonne responsable) B. \u00c0 la suppression d'une EvaluationEtudiant, alors on supprime le document associ\u00e9 (sens inverse du ON CASCADE) </p>"},{"location":"notes_de_cours/section_5.2/#conflits-et-limitations-des-declencheurs-et-des-fonctions","title":"Conflits et limitations des d\u00e9clencheurs et des fonctions","text":"<p>Les cas de figure suivant sont interdits :</p> <ul> <li>Une fonction ne peut pas s'appeler elle-m\u00eame</li> <li>Un d\u00e9clencheur ne peut pas \u00eatre appel\u00e9 sur une table en modification par un d\u00e9clencheur</li> </ul> <p>Un d\u00e9clencheur peut appeler une fonction et l'ex\u00e9cution d'une fonction pourrait activer un d\u00e9clencheur.</p> <p>Les appels implicits sont aussi interdits !</p>"},{"location":"notes_de_cours/section_5.2/#exemple-de-schemas-dexecution-a-probleme","title":"Exemple de sch\u00e9mas d'ex\u00e9cution \u00e0 probl\u00e8me","text":""},{"location":"notes_de_cours/section_5.2/#declencheurs-sur-la-meme-table","title":"D\u00e9clencheurs sur la m\u00eame table","text":"<p>Appeler un d\u00e9clencheur BEFORE et un AFTER sur la m\u00eame table.</p> <ol> <li>La table est verrouill\u00e9e, le d\u00e9clencheur BEFORE s'ex\u00e9cute, la table est lib\u00e9r\u00e9e</li> <li>La requ\u00eate s'ex\u00e9cute</li> <li>La table est verrouill\u00e9e, le d\u00e9clencheur AFTER s'ex\u00e9cute, la table est lib\u00e9r\u00e9e</li> </ol> <p>Donc une table peut d\u00e9finir jusqu'\u00e0 6 d\u00e9clencheurs.</p>"},{"location":"notes_de_cours/section_5.2/#demonstration_1","title":"D\u00e9monstration","text":"<p>Si la date de passation d'une \u00e9valuation est hors de la dur\u00e9e de la session, alors on lui affecte la valeur nulle.</p> <p>G\u00e9rez cette validation pour l'insertion et la modification.</p>"},{"location":"notes_de_cours/section_5.2/#-exercice-523-","title":"--- Exercice 5.2.3 ---","text":"<p>C. Si l'\u00e9valuation ajout\u00e9e cause la somme des pond\u00e9rations du cours \u00e0 exc\u00e9der 100%, alors la pond\u00e9ration devient 0. G\u00e9rez cette validation lors de l'ajout et de la modification.</p>"},{"location":"notes_de_cours/section_5.2/#lire-la-documentation","title":"Lire la documentation","text":"<p> Symbole Signification [ ] Indique un \u00e9l\u00e9ment optionnel \u2026 Ellipse (permet de r\u00e9p\u00e9ter un \u00e9l\u00e9ment) MAJUSCULES Mot-cl\u00e9 du langage Italique Terme d\u00e9finit plus loin | OU { } Un dans la liste est obligatoire <p></p> <p>Le texte contient des informations importantes sur ce qui est permis et le r\u00e9sultat des op\u00e9rations.</p>"},{"location":"notes_de_cours/section_5.3/","title":"Proc\u00e9dures stock\u00e9es et transactions","text":""},{"location":"notes_de_cours/section_5.3/#procedures-stockees","title":"Proc\u00e9dures stock\u00e9es","text":"<p>Les proc\u00e9dures stock\u00e9es sont semblables aux fonctions. Elles permettent de pr\u00e9parer des traitements (comme des fonctions) et de les ex\u00e9cuter. \u00c0 la diff\u00e9rence des fonctions les proc\u00e9dures stock\u00e9es :</p> <ul> <li>Peuvent ne pas retourner de valeur</li> <li>Peuvent s'appeller elle-m\u00eame</li> <li>Les fonctions ne peuvent pas appeler de proc\u00e9dures, mais les proc\u00e9dures peuvent appeler des fonctions</li> </ul>"},{"location":"notes_de_cours/section_5.3/#utilisation-des-procedures-et-des-fonctions","title":"Utilisation des proc\u00e9dures et des fonctions","text":"<p>Les proc\u00e9dures g\u00e8rent g\u00e9n\u00e9ralement la logique applicative (couche m\u00e9tier). Par exemple, les ajouts ou modifications aux donn\u00e9es.</p> <p>Les fonctions d\u00e9finissent g\u00e9n\u00e9ralement un traitement d\u2019appoint, un calcul ou l'obtention d'un renseignement.</p>"},{"location":"notes_de_cours/section_5.3/#declarer-et-invoquer-une-procedure","title":"D\u00e9clarer et invoquer une proc\u00e9dure","text":"<pre><code>DELIMITER $$\n\nCREATE PROCEDURE nom_procedure()\nBEGIN\n  traitement\nEND $$\n\nDELIMITER ;\n</code></pre> <p>Pour invoquer une proc\u00e9dure, on utilise l'instruction CALL.</p> <pre><code>CALL nom_procedure();\n</code></pre>"},{"location":"notes_de_cours/section_5.3/#parametres-de-procedure","title":"Param\u00e8tres de proc\u00e9dure","text":"<p>Les param\u00e8tres d'une proc\u00e9dure peuvent prendre 3 formes :</p> <ul> <li>IN : param\u00e8tre d'entr\u00e9e, donc en lecture seule</li> <li>OUT : param\u00e8tre de sortie, donc en \u00e9criture puis en lecture au besoin</li> <li>INOUT : param\u00e8tre d'entr\u00e9e et de sortie (ref). En lecture et en \u00e9criture.</li> </ul> <p>On inscrit des variables dans les param\u00e8tres OUT pour r\u00e9cup\u00e9rer les valeurs. Si la variable contient d\u00e9j\u00e0 une valeur, il n'est pas possible de la r\u00e9cup\u00e9rer dans la proc\u00e9dure.</p>"},{"location":"notes_de_cours/section_5.3/#exemple","title":"Exemple","text":"<p><pre><code>DELIMITER $$\nCREATE PROCEDURE somme (IN _operande1 INT, IN _operande2 INT, OUT _resultat INT)\nBEGIN   \n  SET _resultat = _operande1 + _operande2;\nEND $$\nDELIMITER ; \n</code></pre> On remarque ici : - L'absence d'instruction RETURN (interdit dans une proc\u00e9dure) - L'utilisation du OUT pour r\u00e9sultat</p>"},{"location":"notes_de_cours/section_5.3/#invocation-de-procedure","title":"Invocation de proc\u00e9dure","text":"<pre><code>SET @resultat = 0;            -- D\u00e9claration d'une variable\nCALL somme(2, 4, @resultat);  -- Invocation\nSELECT @resultat;             -- Affichage\n</code></pre>"},{"location":"notes_de_cours/section_5.3/#documenter-une-procedure","title":"Documenter une proc\u00e9dure","text":"<p>Chaque proc\u00e9dure s'accompagne d'une documentation d'en-t\u00eate</p> <pre><code>/**\n * Description de la proc\u00e9dure\n * \n * @param   IN | OUT | INOUT  Nom du param\u00e8tre  Description   \n * @param   IN | OUT | INOUT  Nom du param\u00e8tre  Description  \n * ...\n */\n</code></pre> <p>Comme les proc\u00e9dures peuvent devenir tr\u00e8s longues, il est important d'utiliser des commentaires pour les variables locales d\u00e9clar\u00e9es et certaines instructions (IF, WHILE, REPEAT ...)</p>"},{"location":"notes_de_cours/section_5.3/#-exercice-531-","title":"--- Exercice 5.3.1 ---","text":"<p>A. Cr\u00e9ez une proc\u00e9dure pour ajouter un nouveau groupe. Initialement l'enseignant est null. Vous connaissez seulement le semestre, l'ann\u00e9e et le sigle du cours. Vous devez ajouter le num\u00e9ro de groupe suivant (si le groupe 1 et 2 existent, alors le groupe aura le num\u00e9ro 3). Le premier groupe porte le num\u00e9ro 1. La proc\u00e9dure retourne le num\u00e9ro du groupe qui a \u00e9t\u00e9 cr\u00e9\u00e9. En cas d'erreur, le num\u00e9ro -1 est retourn\u00e9.</p> <p>Param\u00e8tres : semestre, annee et sigle du cours Valeur de retour : le num\u00e9ro du groupe qui a \u00e9t\u00e9 cr\u00e9\u00e9</p> <p>B. Cr\u00e9ez une proc\u00e9dure pour inscrire un \u00e9tudiant \u00e0 un cours. La proc\u00e9dure re\u00e7oit le code de l'\u00e9tudiant, le sigle du cours, le semestre et l'ann\u00e9e pour l'inscription. </p> <p>L'\u00e9tudiant est toujours ajout\u00e9 au groupe avec le plus petit num\u00e9ro qui a une place de libre. Si le groupe est plein (4 \u00e9tudiants et plus), alors un nouveau groupe est cr\u00e9\u00e9.</p> <p>Le num\u00e9ro du groupe dans lequel l'\u00e9l\u00e8ve a \u00e9t\u00e9 inscrit est retourn\u00e9. En cas d'erreur, la valeur -1 est retourn\u00e9e.</p> <p>Param\u00e8tres : code \u00e9tudiant, sigle du cours, semestre, ann\u00e9e Valeur de retour : num\u00e9ro du groupe dans lequel l'inscription s'est faite</p>"},{"location":"notes_de_cours/section_5.3/#transactions-et-gestion-derreur","title":"Transactions et gestion d'erreur","text":"<p>Concept d'exception en programmation Principe d\u2019une transaction</p>"},{"location":"notes_de_cours/section_5.3/#exceptions-en-programmation","title":"Exceptions en programmation","text":""},{"location":"notes_de_cours/section_5.3/#quand-gerer-les-exceptions","title":"Quand g\u00e9rer les exceptions","text":"<ul> <li>Quand une erreur de fonctionnement impr\u00e9visible est \u00e0 risque de survenir :</li> <li>Donn\u00e9e utilisateur</li> <li>R\u00e9f\u00e9rence \u00e0 un programme externe</li> <li>R\u00e9f\u00e9rence \u00e0 des donn\u00e9es non contr\u00f4l\u00e9es</li> <li>G\u00e9rer certaines sc\u00e9narios d'ex\u00e9cution probl\u00e9matiques</li> </ul>"},{"location":"notes_de_cours/section_5.3/#exceptions-possibles-en-bd","title":"Exceptions possibles en BD","text":"<p>Les exceptions possibles dans le domaine de la BD sont :</p> <ul> <li>Violation de contrainte</li> <li>Duplicat de cl\u00e9 primaire</li> <li>Duplicat de valeur unique</li> <li>Ins\u00e9rer NULL dans une colonne qui n'est pas nullifiable</li> <li>Ne pas respecter un contrainte CHECK</li> <li>Ne pas respecter une cl\u00e9 \u00e9trang\u00e8re </li> <li>Exception personnalis\u00e9es</li> </ul>"},{"location":"notes_de_cours/section_5.3/#codes-derreur-mysql","title":"Codes d'erreur MySQL","text":"<p>Les codes d'erreur de MySQL sont g\u00e9r\u00e9s par les SQLSTATE. Les \u00e9tats SQL sont des codes \u00e0 5 chiffres. Les 2 premiers indiquent un \u00e9tat global (erreur, avertissement, succ\u00e8s, information...) et les 3 derniers sont sp\u00e9cifiques \u00e0 la situation</p> <ul> <li>00### : indique un succ\u00e8s</li> <li>01### : avertissement</li> <li>02### : non trouv\u00e9</li> <li>&gt;02### : exception</li> </ul>"},{"location":"notes_de_cours/section_5.3/#lancer-un-signal","title":"Lancer un signal","text":"<p>Le SGBD lance des sigaux lorsqu'une erreur interne se produit. Il est possible de lancer un signal avec un code d'erreur personnalis\u00e9.</p> <pre><code>SIGNAL SQLSTATE 'code 5 chiffres' SET MESSAGE_TEXT = 'Message erreur';\n</code></pre>"},{"location":"notes_de_cours/section_5.3/#gestion-des-signaux-et-des-transactions","title":"Gestion des signaux et des transactions","text":"<p>Pour attraper un signal, on d\u00e9clare un gestionnaire (handler).</p> <pre><code>DECLARE action HANDLER FOR condition | code\n</code></pre> <p>L'action est de deux types : - CONTINUE : le bloc BEGIN - END continue son ex\u00e9cution apr\u00e8s la gestion du signal - EXIT : le bloc BEGIN - END arr\u00eate son ex\u00e9cution apr\u00e8s la gestion du signal.</p> <p>Les gestionnaires peuvent seulement \u00eatre d\u00e9clar\u00e9s dans les proc\u00e9dures.</p>"},{"location":"notes_de_cours/section_5.3/#condition-du-gestionnaire","title":"Condition du gestionnaire","text":"<p>La condition peut \u00eatre de diff\u00e9rents types. - Une classe de signaux :   - SQLWARNING   - NOT FOUND    - SQLEXCEPTION - Un code particulier :   - Code d'erreur MySQL (4 chiffres) : https://dev.mysql.com/doc/mysql-errors/8.0/en/server-error-reference.html   - Un code de signal SQLSIGNAL code5 - Le nom d'une condition (DECLARE ... CONDITION)</p>"},{"location":"notes_de_cours/section_5.3/#exemple_1","title":"Exemple","text":"<p>Attraper les erreurs de cl\u00e9 primaire nulle <pre><code>DECLARE EXIT HANDLER FOR 1171 \n\n-- Alternative\n\nDECLARE EXIT HANDLER FOR 42000\n</code></pre></p> <p>Attraper toutes les exceptions <pre><code>DECLARE EXIT HANDLER FOR SQLEXCEPTION\n</code></pre></p>"},{"location":"notes_de_cours/section_5.3/#afficher-lerreur","title":"Afficher l'erreur","text":"<p>On r\u00e9cup\u00e8re l'erreur avec une requ\u00eate </p> <pre><code>GET DIAGNOSTICS \n</code></pre> <p>Par exemple pour r\u00e9cup\u00e9rer le code et le message d'erreur actuel</p> <p><pre><code>GET DIAGNOSTICS CONDITION 1            \n  _code = RETURNED_SQLSTATE, \n  _message = MESSAGE_TEXT;\nSELECT _code, _message;\n</code></pre> o\u00f9 _code et _message sont des variables locales</p>"},{"location":"notes_de_cours/section_5.3/#exemple-complet-de-gestion-dexception","title":"Exemple complet de gestion d'exception","text":"<pre><code>CREATE PROCEDURE gestion_erreur()\nBEGIN\n  DECLARE _code CHAR(5);\n  DECLARE _message TEXT;\n  ...\n\n  -- On r\u00e9p\u00e8re ce bloc pour chaque type d'erreur \u00e0 traiter\n  DECLARE EXIT HANDLER FOR 00000\n  BEGIN\n    GET DIAGNOSTICS CONDITION 1\n      _code = RETURNED_SQLSTATE,\n      _message = MESSAGE_TEXT;\n    SELECT _code, _message;\n  END;\n\n  ...\n</code></pre>"},{"location":"notes_de_cours/section_5.3/#transactions-mise-en-situation","title":"Transactions - Mise en situation","text":"<p>Timmy, d\u00e9vou\u00e9 programmeur, cr\u00e9e un script qui importe, dans notre syst\u00e8me \u00c9cole, les notes de tous les \u00e9tudiants \u00e0 une \u00e9valuation . Afin d'\u00e9viter d'ins\u00e9rer de mauvaises donn\u00e9es, Timmy applique la r\u00e8gle suivante : si une des notes ne peut pas \u00eatre ajout\u00e9e (par exemple pour une violation de contrainte), alors aucune note n'est ajout\u00e9e.</p> <p>Si notre script s\u2019ex\u00e9cute automatiquement, comment appliquer cette mesure ?</p>"},{"location":"notes_de_cours/section_5.3/#principe-dune-transaction","title":"Principe d\u2019une transaction","text":"<p>Une transaction contient une s\u00e9rie d\u2019instructions. Une fois que toutes les instructions ont \u00e9t\u00e9 effectu\u00e9es, on peut les enregistrer ou les annuler.</p> <p>L\u2019utilisation de transaction facilite l\u2019ex\u00e9cution d\u2019instructions multiples et aide \u00e0 maintenir une int\u00e9grit\u00e9 dans nos donn\u00e9es.</p>"},{"location":"notes_de_cours/section_5.3/#fonctionnement-dune-transaction","title":"Fonctionnement d'une transaction","text":"<ol> <li>On commence pas indiquer notre intention de faire un bloc d'instructions (transaction) par START TRANSACTION</li> <li>On effectue les requ\u00eates</li> <li>On COMMIT la transaction si tout s'est bien d\u00e9roul\u00e9 OU on ROLLBACK si on veut tout annuler.</li> </ol>"},{"location":"notes_de_cours/section_5.3/#exemple_2","title":"Exemple","text":"<p>Ajoutez la contrainte suivante \u00e0 la table Evaluation_etudiant </p> <pre><code>CONSTRAINT interval_note CHECK (note BETWEEN 0 AND 100)\n</code></pre> <p>D\u00e9sactivons le autocommit de MySQL Workbench</p> <p></p> <p>Ajoutons maintenant les donn\u00e9es suivantes</p> <pre><code>INSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 1234567, 22, NULL);\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 4567890, -5, NULL);\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 8901234, 24, NULL);\n</code></pre> <p>Comment revenir supprimer le premier enregistrement qui s'est bien d\u00e9roul\u00e9 ?</p>"},{"location":"notes_de_cours/section_5.3/#exemple-de-rollback","title":"Exemple de ROLLBACK","text":"<pre><code>SELECT count(id_evaluation) FROM Evaluation_etudiant; -- Affiche 75\n\nSTART TRANSACTION;\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 1234567, 22, NULL);\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 4567890, -5, NULL);\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 8901234, 24, NULL);\n\nSELECT count(id_evaluation) FROM Evaluation_etudiant; -- Affiche 77 (+2)\n\nROLLBACK; -- Il y a eu erreur\n\nSELECT count(id_evaluation) FROM Evaluation_etudiant; -- Affiche 75\n</code></pre>"},{"location":"notes_de_cours/section_5.3/#exemple-de-commit","title":"Exemple de commit","text":"<p>Les INSERT sont valides cette fois-ci.</p> <pre><code>SELECT count(id_evaluation) FROM Evaluation_etudiant; -- Affiche 75\n\nSTART TRANSACTION;\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 1234567, 22, NULL);\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 4567890, 17, NULL);\n\nINSERT INTO Evaluation_etudiant (id_evaluation, etudiant, note, document) VALUES\n  (1, 8901234, 24, NULL);\n\nSELECT count(id_evaluation) FROM Evaluation_etudiant; -- Affiche 78 (+3)\n\nCOMMIT; -- Tout s'est bien d\u00e9roul\u00e9\n\nSELECT count(id_evaluation) FROM Evaluation_etudiant; -- Affiche 78\n</code></pre>"},{"location":"notes_de_cours/section_5.3/#demonstration","title":"D\u00e9monstration","text":"<p>Cr\u00e9ez une proc\u00e9dure pour inscire un nouveau vol. La proc\u00e9dure re\u00e7oit une immatriculation de vaisseau, le num\u00e9ro de vol et le nom du capitaine du vol.</p> <p>La proc\u00e9dure cr\u00e9e le vol et ajoute un membre d'\u00e9quipage, le capitaine. En cas d'erreur, aucune donn\u00e9e ne doit \u00eatre cr\u00e9\u00e9e.</p>"},{"location":"notes_de_cours/section_5.3/#-exercice-532-","title":"--- Exercice 5.3.2 ---","text":"<p>A. Cr\u00e9ez une proc\u00e9dure pour noter un \u00e9tudiant. Cette proc\u00e9dure doit accepter un code \u00e9tudiant, l'id de groupe (que l'on suppose avoir obtenu par un autre moyen) et le nom de l'\u00e9valuation. </p> <p>Supposez que l'id du groupe et le nom de l'\u00e9valuation forme une cl\u00e9 unique.</p> <p>G\u00e9rez l'erreur qui pourrait survenir si l'\u00e9valuation n'existe pas. </p> <p>Votre proc\u00e9dure doit permettre d'assigner une note que Evaluation_etudiant existe ou non au pr\u00e9alable.</p> <p>Param\u00e8tres : code_etudiant, id_groupe, nom_evaluation et note.</p> <p>B. Cr\u00e9ez une proc\u00e9dure pour permettre \u00e0 un \u00e9tudiant de d\u00e9poser un travail. La proc\u00e9dure doit accepter un code etudiant, un id_evaluation (que l'on suppose avoir obtenu par un autre moyen) et les informations relative au document. On suppose que Evaluation_etudiant a d\u00e9j\u00e0 \u00e9t\u00e9 cr\u00e9\u00e9 pour l'\u00e9valuation et l'\u00e9tudiant donn\u00e9. </p> <p>Si un document a d\u00e9j\u00e0 \u00e9t\u00e9 d\u00e9pos\u00e9, alors :</p> <ul> <li>Mettez \u00e0 jour l'information du document</li> <li>D\u00e9clencher un avertissement de code 01001 qui ne bloque pas l'ex\u00e9cution de la proc\u00e9dure</li> </ul> <p>Param\u00e8tres : code_etudiant, id_evaluation et le titre du document</p> <p>C. Vous devez ajouter 3 nouveaux enseignants dans le syst\u00e8me \u00c9cole. Voici les donn\u00e9es de ceux-ci.</p> <p>Effectuez l'op\u00e9ration en utilisant les transactions. Si l'un d'entre eux ne peut pas \u00eatre ajout\u00e9, alors aucune ne doit l'\u00eatre.</p> Code employ\u00e9 Nom No assurance sociale Anciennet\u00e9 7645 Diana de Themyscira 111 222 333 15 7654 Jason Todd 987 654 321 1 6574 Barry Allen 555 777 333 8"}]}